{
  "version": 4,
  "terraform_version": "1.14.3",
  "serial": 84,
  "lineage": "e05b919b-edf6-d388-fe7d-2f0d5cdf29f8",
  "outputs": {
    "db_vm_ip": {
      "value": "192.168.20.21",
      "type": "string"
    },
    "infisical_url": {
      "value": "https://192.168.20.22:8443",
      "type": "string"
    },
    "infisical_vm_ip": {
      "value": "192.168.20.22",
      "type": "string"
    },
    "k3s_vm_ip": {
      "value": "192.168.20.11",
      "type": "string"
    },
    "whisper_api_url": {
      "value": "http://192.168.20.30:8000",
      "type": "string"
    },
    "whisper_vm_ip": {
      "value": "192.168.20.30",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_file",
      "name": "infisical_cloud_init",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content_type": "snippets",
            "datastore_id": "local",
            "file_mode": null,
            "file_modification_date": null,
            "file_name": "infisical-cloud-init.yaml",
            "file_size": null,
            "file_tag": null,
            "id": "local:snippets/infisical-cloud-init.yaml",
            "node_name": "server",
            "overwrite": true,
            "source_file": [],
            "source_raw": [
              {
                "data": "#cloud-config\n\n# Set hostname early (before packages install)\nhostname: infisical\nmanage_etc_hosts: true\n\npackage_update: true\npackage_upgrade: true\n\npackages:\n  - ca-certificates\n  - curl\n  - gnupg\n  - avahi-daemon\n\nwrite_files:\n  - path: /opt/infisical/docker-compose.yml\n    permissions: '0644'\n    content: |\n      version: \"3.9\"\n\n      services:\n        redis:\n          image: redis:7-alpine\n          container_name: infisical-redis\n          restart: unless-stopped\n          volumes:\n            - redis_data:/data\n          healthcheck:\n            test: [\"CMD\", \"redis-cli\", \"ping\"]\n            interval: 10s\n            timeout: 5s\n            retries: 5\n\n        infisical:\n          image: infisical/infisical:latest\n          container_name: infisical\n          restart: unless-stopped\n          ports:\n            - \"8080:8080\"\n          environment:\n            - NODE_ENV=production\n            - ENCRYPTION_KEY=34d19614f7de46fec34763e98cb1648d\n            - AUTH_SECRET=+tXmLH8ByVq0x2YyAPg7jB4OHW6n9HsmL8ZJIkoPvbw=\n            - DB_CONNECTION_URI=postgres://infisical:laEBe7ZLvNPBADCvYH9ei4mQz3ZVk%2FWN@192.168.20.21:5432/infisical\n            - REDIS_URL=redis://redis:6379\n            - SITE_URL=https://192.168.20.22:8443\n            - TELEMETRY_ENABLED=false\n          depends_on:\n            redis:\n              condition: service_healthy\n          healthcheck:\n            test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8080/api/status\"]\n            interval: 30s\n            timeout: 10s\n            retries: 5\n\n        nginx:\n          image: nginx:alpine\n          container_name: infisical-nginx\n          restart: unless-stopped\n          ports:\n            - \"443:443\"\n          volumes:\n            - ./nginx.conf:/etc/nginx/nginx.conf:ro\n            - ./certs:/etc/nginx/certs:ro\n          depends_on:\n            - infisical\n          healthcheck:\n            test: [\"CMD\", \"wget\", \"-q\", \"--spider\", \"http://localhost:80/health\"]\n            interval: 30s\n            timeout: 10s\n            retries: 3\n\n      volumes:\n        redis_data:\n\n      networks:\n        default:\n          name: infisical-network\n\n  - path: /opt/infisical/.env\n    permissions: '0600'\n    content: |\n      # Infisical environment - managed by Terraform\n      ENCRYPTION_KEY=34d19614f7de46fec34763e98cb1648d\n      AUTH_SECRET=+tXmLH8ByVq0x2YyAPg7jB4OHW6n9HsmL8ZJIkoPvbw=\n      POSTGRES_HOST=192.168.20.21\n      POSTGRES_PORT=5432\n      POSTGRES_DB=infisical\n      POSTGRES_USER=infisical\n      POSTGRES_PASSWORD=laEBe7ZLvNPBADCvYH9ei4mQz3ZVk/WN\n\n  - path: /opt/infisical/nginx.conf\n    permissions: '0644'\n    content: |\n      events {\n          worker_connections 1024;\n      }\n\n      http {\n          upstream infisical {\n              server infisical:8080;\n          }\n\n          server {\n              listen 80;\n              location /health {\n                  return 200 'ok';\n                  add_header Content-Type text/plain;\n              }\n              location / {\n                  return 301 https://$host$request_uri;\n              }\n          }\n\n          server {\n              listen 443 ssl;\n              server_name infisical.local;\n\n              ssl_certificate /etc/nginx/certs/cert.pem;\n              ssl_certificate_key /etc/nginx/certs/key.pem;\n              ssl_protocols TLSv1.2 TLSv1.3;\n              ssl_ciphers HIGH:!aNULL:!MD5;\n\n              location / {\n                  proxy_pass http://infisical;\n                  proxy_set_header Host $host;\n                  proxy_set_header X-Real-IP $remote_addr;\n                  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                  proxy_set_header X-Forwarded-Proto $scheme;\n\n                  # WebSocket support\n                  proxy_http_version 1.1;\n                  proxy_set_header Upgrade $http_upgrade;\n                  proxy_set_header Connection \"upgrade\";\n              }\n          }\n      }\n\n  - path: /etc/systemd/system/infisical.service\n    permissions: '0644'\n    content: |\n      [Unit]\n      Description=Infisical Secret Management\n      Requires=docker.service\n      After=docker.service\n\n      [Service]\n      Type=oneshot\n      RemainAfterExit=yes\n      WorkingDirectory=/opt/infisical\n      ExecStart=/usr/bin/docker compose up -d\n      ExecStop=/usr/bin/docker compose down\n\n      [Install]\n      WantedBy=multi-user.target\n\n  - path: /opt/infisical/certs/cert.pem\n    permissions: '0644'\n    content: |\n      -----BEGIN CERTIFICATE-----\n      MIIElDCCAvygAwIBAgIRAPRhVyAQwX8KazirE3Zrzc0wDQYJKoZIhvcNAQELBQAw\n      gakxHjAcBgNVBAoTFW1rY2VydCBkZXZlbG9wbWVudCBDQTE/MD0GA1UECww2cHJh\n      a2FzaEBNYWNCb29rLVByby1NMy1kZS1QcmFrYXNoLmxvY2FsIChQcmFrYXNoIFBy\n      ZW0pMUYwRAYDVQQDDD1ta2NlcnQgcHJha2FzaEBNYWNCb29rLVByby1NMy1kZS1Q\n      cmFrYXNoLmxvY2FsIChQcmFrYXNoIFByZW0pMB4XDTI2MDExMDE2NDEyOFoXDTI4\n      MDQxMDE2NDEyOFowajEnMCUGA1UEChMebWtjZXJ0IGRldmVsb3BtZW50IGNlcnRp\n      ZmljYXRlMT8wPQYDVQQLDDZwcmFrYXNoQE1hY0Jvb2stUHJvLU0zLWRlLVByYWth\n      c2gubG9jYWwgKFByYWthc2ggUHJlbSkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw\n      ggEKAoIBAQCukN/HYCeZp2W7MRhHZNaiWlzvYm85hkdkXXCspwOcCGOupDAUKIlO\n      ygVxueXJQQE0X4G3TmWFePldRMyhPQSzN9q/R6WC5+omvWHe5mnRx4zqauwNrEF9\n      ELgwVaqzKVpyQHo556KgfrEbMSO7cVdSQuPmIGA9+AHQbc9f2Z3z17sntTTbvNaX\n      668Zjl5K/h5eqAZHrdNc2VHtUTVEqdtPW5t8ySZ6Zxqq4SrEavMSX8HfI3FBe4u0\n      8R28Ivr6a09qbXlDfgdq+blRcMYnK2eeAmKFgB2woOW7wj/TCMzTm95TIHXrhwep\n      t88rzLVUm6TcP3s2MaMMTSqLEXP/wGXPAgMBAAGjdTBzMA4GA1UdDwEB/wQEAwIF\n      oDATBgNVHSUEDDAKBggrBgEFBQcDATAfBgNVHSMEGDAWgBTBE5p1B2rilKWfz3pV\n      699bwgJ/ADArBgNVHREEJDAigg9pbmZpc2ljYWwubG9jYWyCCWxvY2FsaG9zdIcE\n      wKgUFjANBgkqhkiG9w0BAQsFAAOCAYEAAgaDIpHFZGHpDe+lfW2N6/rV+S4BjMqK\n      pio83jQc6pwrsrHRj4aGI/IxywsPBr7jIm5W8Mcpk7Hn4+aaiJap6agyqKrvCKiz\n      SsCVVuz/9UR0LDqJ+AxscgFaC/3q3bNTJ4FxP3KimsItoB6vEuKQ0n67jLuNcZQo\n      yfReZxppdi7PX1CG4dqMKDxRMV62GOiTU4c8Puqbvjg3pSF9nM9j7/hV5mbxh0UB\n      2wwIab2+x1uEHEP8ESM7RWKm92RbLg+kVOnoWigfn2/wITS+Kf6k2vV/TXSQJyrL\n      Rdk9M0YSa9gO68GC3KTwu7qVHjfoxOXo51nuZsEZi9mWMYaghSa0c2ptm66Bb7f+\n      u+l2SNPBqmMWzW6Au6PFmM8AbEfynrTNpPM+aEiep4psb8UxRjlmoonzmauHFS5c\n      imbrDfOzT+WH+C9wZDrEPxwewWvpv9C/qAuN72QoinebBb0rKrPqutDoPJ7dKQtH\n      uw7wfPhQQ8gYY8tPXQ+3TEtKkvSZuUzb\n      -----END CERTIFICATE-----\n      \n\n  - path: /opt/infisical/certs/key.pem\n    permissions: '0600'\n    content: |\n      -----BEGIN PRIVATE KEY-----\n      MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCukN/HYCeZp2W7\n      MRhHZNaiWlzvYm85hkdkXXCspwOcCGOupDAUKIlOygVxueXJQQE0X4G3TmWFePld\n      RMyhPQSzN9q/R6WC5+omvWHe5mnRx4zqauwNrEF9ELgwVaqzKVpyQHo556KgfrEb\n      MSO7cVdSQuPmIGA9+AHQbc9f2Z3z17sntTTbvNaX668Zjl5K/h5eqAZHrdNc2VHt\n      UTVEqdtPW5t8ySZ6Zxqq4SrEavMSX8HfI3FBe4u08R28Ivr6a09qbXlDfgdq+blR\n      cMYnK2eeAmKFgB2woOW7wj/TCMzTm95TIHXrhwept88rzLVUm6TcP3s2MaMMTSqL\n      EXP/wGXPAgMBAAECggEAAdXx0ZW96TrsyWbh8u76oEu4Pqd6nZZWiyFgyPRhB8rv\n      4iV0DFgJ4CfHhw8XTuI32AZVFyap/hkO8Ssl9NR6zVryYAl7TF3vELOXI0Cpl6uc\n      6AVyMGaesgvnazn58aiPwqhdSWj2ojX7leYSqdl/6gi5fytk5j8EyAwPkwiOXMLk\n      MJOvcGqJ0gJtqO8+SINtEq+U1Qmti++fSchZvxrXgvpvqYWFsuBEFK8BbbnuBkB9\n      3+LPYV/dhUqIBhhwPJqemKo+UQPY0tkpka2aRoiTUuEnqs8LhD66RA8LSIUsLFsV\n      07OniGx4F20Sp+R1Q0GUvBUnSA1gYW54DOoR9h+GGQKBgQDjwNJORDrdkYq6Y4FY\n      atE7+KTx7wBDWCTTL36nJQBqfDhtVcdIJtD17NIFv1hPzXv1XaygoURQRoq5WZXo\n      mbE/Y6pQmWQjnXjpy8YYgi2MzrVChO0RNhDFGMelHBRF054IYi6UjwNxy/UJxSuI\n      MQst64Xe4/0c/sVGbRHdUu7KswKBgQDEN1pM+XHyM+hjvh+vAwf+aywEafsMDxOs\n      UFf7KYpHl7Cz/j9hb+5265S5s46pR6t1pcf/QmH9CUcBYP6uX4fgI1s50wB0WCmQ\n      +W3pdzkSBXUJ/6JtfVe2g34kJWDNWKxaBZntWp9Jc/hdgflBPHE7ZWdIVGRhwV70\n      DHYg/LQ2dQKBgH22/p8DHHcXEjtmF4yFka8HxYxhv4Rs0A7eRYvfacZdgQwg8BpM\n      isVkjl1rzERoiUbcCSC1Q68H8ST0ZUH6LBNwYR+SO+tIzehHebYnjRsPMpBgLTd1\n      33XcAr+Jq0sLz0yTXWDVPDKBQWW+NxQ69g/H1KI+uIVbv+rq45SGZZbvAoGBAKRL\n      YN4RA9r0ocJaoLbvB9N9M2ciwmWPfj6LK5APcUyO9BNScQmKKpcCnQ59DZgqfaPN\n      w0+16sxv5zd9WuLw9Jm1oR4i0j+Yzn0ojWKuRGgVj7Fmjj+1cytMoONtNMfcVrwt\n      8nwupC9h3nWVbfq0vG8qcje7Ci5cNsCMaqEmV1M9AoGBALNNB2VWkppOvhkLqslp\n      CafOEeG3nlGyBDwJnFBB2GDSANWuhXVEFd4yQwQVzreNnqGRgI8FE+bZWN3UuUDf\n      LcucvXnjkqz1GhTAHcysBQAk5WvYQw4q38/FU3/jkbWb9RoIDFI79q5CSqM3QYIJ\n      vV0zti7tCdj4t4c2YGgIsaQs\n      -----END PRIVATE KEY-----\n      \n\nruncmd:\n  # Ensure avahi is enabled (hostname already set via cloud-init)\n  - systemctl enable avahi-daemon\n  - systemctl restart avahi-daemon\n\n  # Install Docker\n  - install -m 0755 -d /etc/apt/keyrings\n  - curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc\n  - chmod a+r /etc/apt/keyrings/docker.asc\n  - echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian $(. /etc/os-release \u0026\u0026 echo \"$VERSION_CODENAME\") stable\" | tee /etc/apt/sources.list.d/docker.list \u003e /dev/null\n  - apt-get update\n  - apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n\n  # Add deployer user to docker group\n  - usermod -aG docker deployer\n\n  # Enable and start Docker\n  - systemctl enable docker\n  - systemctl start docker\n\n  # Wait for Docker to be ready\n  - sleep 10\n\n  # Enable and start Infisical\n  - systemctl daemon-reload\n  - systemctl enable infisical\n  - systemctl start infisical\n\nfinal_message: \"Infisical server is ready! Access at https://$INSTANCE_IP:8443\"\n",
                "file_name": "infisical-cloud-init.yaml",
                "resize": 0
              }
            ],
            "timeout_upload": 1800
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "source_raw"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "data"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_file",
      "name": "whisper_cloud_init",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content_type": "snippets",
            "datastore_id": "local",
            "file_mode": null,
            "file_modification_date": null,
            "file_name": "whisper-cloud-init.yaml",
            "file_size": null,
            "file_tag": null,
            "id": "local:snippets/whisper-cloud-init.yaml",
            "node_name": "server",
            "overwrite": true,
            "source_file": [],
            "source_raw": [
              {
                "data": "#cloud-config\n# Whisper GPU Inference Server - Fully Automated Setup\n# Automatically installs NVIDIA drivers, reboots, then sets up Whisper API\n\npackage_update: true\npackage_upgrade: false\n\npackages:\n  - build-essential\n  - python3\n  - python3-pip\n  - python3-venv\n  - git\n  - curl\n  - wget\n  - gnupg\n  - htop\n  - ffmpeg\n  - libsndfile1\n  - debconf-utils\n\nusers:\n  - default\n  - name: whisper\n    groups: [sudo, video, render]\n    shell: /bin/bash\n    sudo: ALL=(ALL) NOPASSWD:ALL\n\nwrite_files:\n  # Main auto-setup script - runs on every boot until complete\n  - path: /opt/whisper/auto-setup.sh\n    permissions: \"0755\"\n    content: |\n      #!/bin/bash\n      # Automated Whisper GPU Setup\n      # This script runs on every boot until setup is complete\n\n      LOG_FILE=\"/var/log/whisper-setup.log\"\n      exec \u003e \u003e(tee -a \"$LOG_FILE\") 2\u003e\u00261\n\n      echo \"\"\n      echo \"==========================================\"\n      echo \"Whisper Auto-Setup - $(date)\"\n      echo \"==========================================\"\n\n      # State files\n      NVIDIA_DONE=\"/opt/whisper/.nvidia_installed\"\n      PYTHON_DONE=\"/opt/whisper/.python_installed\"\n      SETUP_COMPLETE=\"/opt/whisper/.setup_complete\"\n\n      # If setup is complete, disable this service and exit\n      if [ -f \"$SETUP_COMPLETE\" ]; then\n          echo \"Setup already complete. Disabling auto-setup service.\"\n          systemctl disable whisper-auto-setup.service\n          exit 0\n      fi\n\n      # Ensure ownership\n      chown -R whisper:whisper /opt/whisper\n\n      # STAGE 1: Install NVIDIA drivers\n      if [ ! -f \"$NVIDIA_DONE\" ]; then\n          echo \"\"\n          echo \"=== STAGE 1: Installing NVIDIA drivers ===\"\n\n          # Make apt fully non-interactive (no prompts)\n          export DEBIAN_FRONTEND=noninteractive\n          export NEEDRESTART_MODE=a\n\n          # Pre-configure keyboard to avoid prompt\n          echo 'keyboard-configuration keyboard-configuration/layoutcode string us' | debconf-set-selections\n          echo 'keyboard-configuration keyboard-configuration/layout select English (US)' | debconf-set-selections\n\n          # Enable non-free repos for Debian\n          if [ -f /etc/apt/sources.list.d/debian.sources ]; then\n              sed -i 's/Components: main$/Components: main contrib non-free non-free-firmware/' /etc/apt/sources.list.d/debian.sources\n          fi\n\n          apt-get update\n          apt-get install -y -o Dpkg::Options::=\"--force-confdef\" -o Dpkg::Options::=\"--force-confold\" linux-headers-$(uname -r)\n          apt-get install -y -o Dpkg::Options::=\"--force-confdef\" -o Dpkg::Options::=\"--force-confold\" nvidia-driver firmware-misc-nonfree\n\n          # Mark stage complete\n          touch \"$NVIDIA_DONE\"\n\n          echo \"\"\n          echo \"NVIDIA drivers installed. Rebooting in 10 seconds...\"\n          sleep 10\n          reboot\n          exit 0\n      fi\n\n      # STAGE 2: Verify GPU and setup Python\n      if [ ! -f \"$PYTHON_DONE\" ]; then\n          echo \"\"\n          echo \"=== STAGE 2: Setting up Python environment ===\"\n\n          # Verify GPU\n          if ! nvidia-smi; then\n              echo \"ERROR: NVIDIA GPU not detected after driver install.\"\n              echo \"Will retry on next boot...\"\n              exit 1\n          fi\n\n          echo \"GPU detected:\"\n          nvidia-smi\n\n          # Setup Python as whisper user\n          sudo -u whisper /opt/whisper/setup-python.sh\n\n          # Mark stage complete\n          touch \"$PYTHON_DONE\"\n          chown whisper:whisper \"$PYTHON_DONE\"\n      fi\n\n      # STAGE 3: Start service\n      echo \"\"\n      echo \"=== STAGE 3: Starting Whisper API service ===\"\n\n      chown -R whisper:whisper /opt/whisper\n\n      systemctl daemon-reload\n      systemctl enable whisper-api\n      systemctl start whisper-api\n\n      # Wait for service to start\n      sleep 5\n\n      # Verify service is running\n      if systemctl is-active --quiet whisper-api; then\n          touch \"$SETUP_COMPLETE\"\n          chown whisper:whisper \"$SETUP_COMPLETE\"\n\n          echo \"\"\n          echo \"==========================================\"\n          echo \"SETUP COMPLETE!\"\n          echo \"==========================================\"\n          echo \"\"\n          echo \"Whisper API: http://$(hostname -I | awk '{print $1}'):8000\"\n          echo \"\"\n          echo \"Test: curl http://$(hostname -I | awk '{print $1}'):8000/health\"\n          echo \"\"\n\n          # Disable auto-setup service\n          systemctl disable whisper-auto-setup.service\n      else\n          echo \"ERROR: whisper-api service failed to start\"\n          journalctl -u whisper-api -n 20 --no-pager\n          exit 1\n      fi\n\n  # Systemd service for auto-setup (runs on every boot until complete)\n  - path: /etc/systemd/system/whisper-auto-setup.service\n    permissions: \"0644\"\n    content: |\n      [Unit]\n      Description=Whisper GPU Auto-Setup\n      After=network-online.target\n      Wants=network-online.target\n\n      [Service]\n      Type=oneshot\n      ExecStart=/opt/whisper/auto-setup.sh\n      RemainAfterExit=yes\n      StandardOutput=journal+console\n      StandardError=journal+console\n\n      [Install]\n      WantedBy=multi-user.target\n\n  # Python setup script\n  - path: /opt/whisper/setup-python.sh\n    permissions: \"0755\"\n    content: |\n      #!/bin/bash\n      set -e\n\n      echo \"Setting up Python environment...\"\n\n      cd /opt/whisper\n\n      # Create virtual environment\n      python3 -m venv venv\n      source venv/bin/activate\n\n      # Upgrade pip\n      pip install --upgrade pip wheel setuptools\n\n      # Install PyTorch with CUDA support\n      pip install torch --index-url https://download.pytorch.org/whl/cu121\n\n      # Install requirements\n      pip install -r requirements.txt\n\n      # Download the turbo model\n      echo \"Downloading Whisper turbo model...\"\n      python3 -c \"\n      import whisper\n      print('Downloading turbo model...')\n      model = whisper.load_model('turbo', device='cpu')\n      print('Model downloaded successfully!')\n      \"\n\n      echo \"Python setup complete!\"\n\n  # Requirements file\n  - path: /opt/whisper/requirements.txt\n    permissions: \"0644\"\n    content: |\n      openai-whisper\n      fastapi\u003e=0.109.0\n      uvicorn[standard]\u003e=0.27.0\n      python-multipart\u003e=0.0.6\n      pydantic\u003e=2.0.0\n\n  # Whisper API service\n  - path: /opt/whisper/api.py\n    permissions: \"0644\"\n    content: |\n      #!/usr/bin/env python3\n      \"\"\"\n      Whisper Transcription API\n      Using OpenAI's official Whisper - works with Maxwell GPUs.\n      \"\"\"\n      import os\n      import tempfile\n      import time\n      from pathlib import Path\n      from typing import Optional\n\n      from fastapi import FastAPI, File, UploadFile, HTTPException, Query\n      from pydantic import BaseModel\n      import uvicorn\n      import torch\n\n      app = FastAPI(\n          title=\"Whisper Transcription API\",\n          description=\"GPU-accelerated speech-to-text using OpenAI Whisper\",\n          version=\"2.0.0\"\n      )\n\n      MODEL_NAME = os.getenv(\"WHISPER_MODEL\", \"turbo\")\n      DEVICE = os.getenv(\"WHISPER_DEVICE\", \"cuda\" if torch.cuda.is_available() else \"cpu\")\n\n      _model = None\n\n      def get_model():\n          global _model\n          if _model is None:\n              import whisper\n              print(f\"Loading Whisper model: {MODEL_NAME} on {DEVICE}\")\n              _model = whisper.load_model(MODEL_NAME, device=DEVICE)\n              print(\"Model loaded successfully!\")\n          return _model\n\n      class TranscriptionResponse(BaseModel):\n          text: str\n          language: str\n          duration: Optional[float] = None\n          processing_time: float\n          segments: Optional[list] = None\n\n      class HealthResponse(BaseModel):\n          status: str\n          model: str\n          device: str\n          gpu_available: bool\n          gpu_name: Optional[str] = None\n\n      @app.get(\"/health\", response_model=HealthResponse)\n      async def health_check():\n          gpu_available = torch.cuda.is_available()\n          gpu_name = torch.cuda.get_device_name(0) if gpu_available else None\n          return HealthResponse(\n              status=\"healthy\",\n              model=MODEL_NAME,\n              device=DEVICE,\n              gpu_available=gpu_available,\n              gpu_name=gpu_name\n          )\n\n      @app.post(\"/transcribe\", response_model=TranscriptionResponse)\n      async def transcribe(\n          file: UploadFile = File(...),\n          language: Optional[str] = Query(None),\n          include_segments: bool = Query(False),\n          task: str = Query(\"transcribe\")\n      ):\n          start_time = time.time()\n          allowed_extensions = {\".mp3\", \".wav\", \".m4a\", \".ogg\", \".flac\", \".webm\", \".mp4\", \".opus\"}\n          file_ext = Path(file.filename).suffix.lower() if file.filename else \"\"\n\n          if file_ext not in allowed_extensions:\n              raise HTTPException(status_code=400, detail=f\"Unsupported: {file_ext}\")\n\n          with tempfile.NamedTemporaryFile(delete=False, suffix=file_ext) as tmp:\n              content = await file.read()\n              tmp.write(content)\n              tmp_path = tmp.name\n\n          try:\n              model = get_model()\n              options = {\"task\": task}\n              if language:\n                  options[\"language\"] = language\n\n              result = model.transcribe(tmp_path, **options)\n\n              segments_list = None\n              if include_segments and \"segments\" in result:\n                  segments_list = [\n                      {\"start\": round(s[\"start\"], 2), \"end\": round(s[\"end\"], 2), \"text\": s[\"text\"].strip()}\n                      for s in result[\"segments\"]\n                  ]\n\n              return TranscriptionResponse(\n                  text=result[\"text\"].strip(),\n                  language=result.get(\"language\", \"unknown\"),\n                  processing_time=round(time.time() - start_time, 2),\n                  segments=segments_list\n              )\n          except Exception as e:\n              raise HTTPException(status_code=500, detail=str(e))\n          finally:\n              os.unlink(tmp_path)\n\n      @app.post(\"/transcribe/batch\")\n      async def transcribe_batch(\n          files: list[UploadFile] = File(...),\n          language: Optional[str] = Query(None),\n          include_segments: bool = Query(False),\n          task: str = Query(\"transcribe\")\n      ):\n          \"\"\"Transcribe multiple audio files in a single request.\"\"\"\n          start_time = time.time()\n          allowed_extensions = {\".mp3\", \".wav\", \".m4a\", \".ogg\", \".flac\", \".webm\", \".mp4\", \".opus\"}\n          model = get_model()\n\n          results = []\n          for file in files:\n              file_start = time.time()\n              file_ext = Path(file.filename).suffix.lower() if file.filename else \"\"\n\n              if file_ext not in allowed_extensions:\n                  results.append({\n                      \"filename\": file.filename,\n                      \"error\": f\"Unsupported file type: {file_ext}\"\n                  })\n                  continue\n\n              with tempfile.NamedTemporaryFile(delete=False, suffix=file_ext) as tmp:\n                  content = await file.read()\n                  tmp.write(content)\n                  tmp_path = tmp.name\n\n              try:\n                  options = {\"task\": task}\n                  if language:\n                      options[\"language\"] = language\n\n                  result = model.transcribe(tmp_path, **options)\n\n                  segments_list = None\n                  if include_segments and \"segments\" in result:\n                      segments_list = [\n                          {\"start\": round(s[\"start\"], 2), \"end\": round(s[\"end\"], 2), \"text\": s[\"text\"].strip()}\n                          for s in result[\"segments\"]\n                      ]\n\n                  results.append({\n                      \"filename\": file.filename,\n                      \"text\": result[\"text\"].strip(),\n                      \"language\": result.get(\"language\", \"unknown\"),\n                      \"processing_time\": round(time.time() - file_start, 2),\n                      \"segments\": segments_list\n                  })\n              except Exception as e:\n                  results.append({\n                      \"filename\": file.filename,\n                      \"error\": str(e)\n                  })\n              finally:\n                  os.unlink(tmp_path)\n\n          return {\n              \"total_files\": len(files),\n              \"total_processing_time\": round(time.time() - start_time, 2),\n              \"results\": results\n          }\n\n      @app.post(\"/transcribe/url\")\n      async def transcribe_url(\n          url: str,\n          language: Optional[str] = None,\n          include_segments: bool = False,\n          task: str = \"transcribe\"\n      ):\n          import subprocess\n          start_time = time.time()\n\n          with tempfile.NamedTemporaryFile(delete=False, suffix=\".wav\") as tmp:\n              tmp_path = tmp.name\n\n          try:\n              result = subprocess.run(\n                  [\"ffmpeg\", \"-i\", url, \"-ar\", \"16000\", \"-ac\", \"1\", \"-y\", tmp_path],\n                  capture_output=True, timeout=300\n              )\n              if result.returncode != 0:\n                  raise HTTPException(status_code=400, detail=f\"FFmpeg failed: {result.stderr.decode()}\")\n\n              model = get_model()\n              options = {\"task\": task}\n              if language:\n                  options[\"language\"] = language\n\n              result = model.transcribe(tmp_path, **options)\n\n              segments_list = None\n              if include_segments and \"segments\" in result:\n                  segments_list = [\n                      {\"start\": round(s[\"start\"], 2), \"end\": round(s[\"end\"], 2), \"text\": s[\"text\"].strip()}\n                      for s in result[\"segments\"]\n                  ]\n\n              return TranscriptionResponse(\n                  text=result[\"text\"].strip(),\n                  language=result.get(\"language\", \"unknown\"),\n                  processing_time=round(time.time() - start_time, 2),\n                  segments=segments_list\n              )\n          finally:\n              if os.path.exists(tmp_path):\n                  os.unlink(tmp_path)\n\n      if __name__ == \"__main__\":\n          print(\"Pre-loading Whisper model...\")\n          get_model()\n          print(\"Starting API server...\")\n          uvicorn.run(app, host=\"0.0.0.0\", port=8000)\n\n  # Systemd service for Whisper API\n  - path: /etc/systemd/system/whisper-api.service\n    permissions: \"0644\"\n    content: |\n      [Unit]\n      Description=Whisper Transcription API\n      After=network.target\n\n      [Service]\n      Type=simple\n      User=whisper\n      Group=whisper\n      WorkingDirectory=/opt/whisper\n      Environment=\"PATH=/opt/whisper/venv/bin:/usr/local/bin:/usr/bin:/bin\"\n      Environment=\"WHISPER_MODEL=turbo\"\n      Environment=\"WHISPER_DEVICE=cuda\"\n      ExecStart=/opt/whisper/venv/bin/python /opt/whisper/api.py\n      Restart=always\n      RestartSec=10\n      SupplementaryGroups=video render\n\n      [Install]\n      WantedBy=multi-user.target\n\nruncmd:\n  - mkdir -p /opt/whisper/models\n  - chown -R whisper:whisper /opt/whisper\n  - echo \"Whisper cloud-init started at $(date)\" \u003e\u003e /var/log/whisper-setup.log\n  # Enable and start auto-setup service\n  - systemctl daemon-reload\n  - systemctl enable whisper-auto-setup.service\n  - systemctl start whisper-auto-setup.service\n",
                "file_name": "whisper-cloud-init.yaml",
                "resize": 0
              }
            ],
            "timeout_upload": 1800
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_vm",
      "name": "db_postgres",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acpi": true,
            "agent": [],
            "amd_sev": [],
            "audio_device": [],
            "bios": "ovmf",
            "boot_order": [
              "scsi0"
            ],
            "cdrom": [],
            "clone": [
              {
                "datastore_id": "",
                "full": true,
                "node_name": "server",
                "retries": 1,
                "vm_id": 9001
              }
            ],
            "cpu": [
              {
                "affinity": "",
                "architecture": "",
                "cores": 4,
                "flags": [],
                "hotplugged": 0,
                "limit": 0,
                "numa": false,
                "sockets": 1,
                "type": "host",
                "units": 0
              }
            ],
            "delete_unreferenced_disks_on_destroy": true,
            "description": "Postgres database host",
            "disk": [
              {
                "aio": "io_uring",
                "backup": true,
                "cache": "none",
                "datastore_id": "local-lvm",
                "discard": "ignore",
                "file_format": "raw",
                "file_id": "",
                "import_from": "",
                "interface": "scsi0",
                "iothread": false,
                "path_in_datastore": "vm-113-disk-1",
                "replicate": true,
                "serial": "",
                "size": 60,
                "speed": [],
                "ssd": false
              }
            ],
            "efi_disk": [],
            "hook_script_file_id": null,
            "hostpci": [],
            "id": "113",
            "initialization": [
              {
                "datastore_id": "local-lvm",
                "dns": [
                  {
                    "domain": "",
                    "servers": [
                      "1.1.1.1"
                    ]
                  }
                ],
                "file_format": "",
                "interface": "ide2",
                "ip_config": [
                  {
                    "ipv4": [
                      {
                        "address": "192.168.20.21/24",
                        "gateway": "192.168.20.1"
                      }
                    ],
                    "ipv6": []
                  }
                ],
                "meta_data_file_id": "",
                "network_data_file_id": "",
                "type": "",
                "user_account": [
                  {
                    "keys": [
                      "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAhLzivPgJGOMkfj6Fg8WBbPvJIMLQHjpFTnXZVsncBg prakash2ji@gmail.com"
                    ],
                    "password": "**********",
                    "username": "deployer"
                  }
                ],
                "user_data_file_id": "",
                "vendor_data_file_id": ""
              }
            ],
            "ipv4_addresses": [
              [
                "127.0.0.1"
              ],
              [
                "192.168.20.21"
              ]
            ],
            "ipv6_addresses": [
              [
                "::1"
              ],
              [
                "fdd5:945b:3322:0:be24:11ff:fe4c:ce72",
                "fe80::be24:11ff:fe4c:ce72"
              ]
            ],
            "keyboard_layout": "en-us",
            "kvm_arguments": null,
            "mac_addresses": [
              "00:00:00:00:00:00",
              "BC:24:11:4C:CE:72"
            ],
            "machine": "q35",
            "memory": [
              {
                "dedicated": 8192,
                "floating": 0,
                "hugepages": "",
                "keep_hugepages": false,
                "shared": 0
              }
            ],
            "migrate": false,
            "name": "db-postgres",
            "network_device": [
              {
                "bridge": "vmbr0",
                "disconnected": false,
                "enabled": true,
                "firewall": false,
                "mac_address": "BC:24:11:4C:CE:72",
                "model": "virtio",
                "mtu": 0,
                "queues": 0,
                "rate_limit": 0,
                "trunks": "",
                "vlan_id": 0
              }
            ],
            "network_interface_names": [
              "lo",
              "eth0"
            ],
            "node_name": "server",
            "numa": [],
            "on_boot": true,
            "operating_system": [
              {
                "type": "l26"
              }
            ],
            "pool_id": "",
            "protection": false,
            "purge_on_destroy": true,
            "reboot": false,
            "reboot_after_update": true,
            "rng": [],
            "scsi_hardware": "virtio-scsi-single",
            "serial_device": [],
            "smbios": [],
            "started": true,
            "startup": [
              {
                "down_delay": 60,
                "order": 1,
                "up_delay": 60
              }
            ],
            "stop_on_destroy": false,
            "tablet_device": true,
            "tags": [
              "db",
              "postgres"
            ],
            "template": false,
            "timeout_clone": 1800,
            "timeout_create": 1800,
            "timeout_migrate": 1800,
            "timeout_move_disk": 1800,
            "timeout_reboot": 1800,
            "timeout_shutdown_vm": 1800,
            "timeout_start_vm": 1800,
            "timeout_stop_vm": 300,
            "tpm_state": [],
            "usb": [],
            "vga": [],
            "virtiofs": [],
            "vm_id": 113,
            "watchdog": []
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "initialization"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "user_account"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "password"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_vm",
      "name": "infisical",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acpi": true,
            "agent": [],
            "amd_sev": [],
            "audio_device": [],
            "bios": "ovmf",
            "boot_order": [
              "scsi0"
            ],
            "cdrom": [],
            "clone": [
              {
                "datastore_id": "",
                "full": true,
                "node_name": "server",
                "retries": 1,
                "vm_id": 9001
              }
            ],
            "cpu": [
              {
                "affinity": "",
                "architecture": "",
                "cores": 2,
                "flags": [],
                "hotplugged": 0,
                "limit": 0,
                "numa": false,
                "sockets": 1,
                "type": "host",
                "units": 0
              }
            ],
            "delete_unreferenced_disks_on_destroy": true,
            "description": "Infisical secret management server",
            "disk": [
              {
                "aio": "io_uring",
                "backup": true,
                "cache": "none",
                "datastore_id": "local-lvm",
                "discard": "ignore",
                "file_format": "raw",
                "file_id": "",
                "import_from": "",
                "interface": "scsi0",
                "iothread": false,
                "path_in_datastore": "vm-114-disk-1",
                "replicate": true,
                "serial": "",
                "size": 20,
                "speed": [],
                "ssd": false
              }
            ],
            "efi_disk": [],
            "hook_script_file_id": null,
            "hostpci": [],
            "id": "114",
            "initialization": [
              {
                "datastore_id": "local-lvm",
                "dns": [
                  {
                    "domain": "",
                    "servers": [
                      "1.1.1.1"
                    ]
                  }
                ],
                "file_format": "",
                "interface": "ide2",
                "ip_config": [
                  {
                    "ipv4": [
                      {
                        "address": "192.168.20.22/24",
                        "gateway": "192.168.20.1"
                      }
                    ],
                    "ipv6": []
                  }
                ],
                "meta_data_file_id": "",
                "network_data_file_id": "",
                "type": "",
                "user_account": [
                  {
                    "keys": [
                      "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAhLzivPgJGOMkfj6Fg8WBbPvJIMLQHjpFTnXZVsncBg prakash2ji@gmail.com"
                    ],
                    "password": "**********",
                    "username": "deployer"
                  }
                ],
                "user_data_file_id": "local:snippets/infisical-cloud-init.yaml",
                "vendor_data_file_id": ""
              }
            ],
            "ipv4_addresses": [
              [
                "127.0.0.1"
              ],
              [
                "192.168.20.22"
              ],
              [
                "172.17.0.1"
              ],
              [
                "172.18.0.1"
              ],
              [],
              [],
              []
            ],
            "ipv6_addresses": [
              [
                "::1"
              ],
              [
                "fdd5:945b:3322:0:be24:11ff:fe46:9189",
                "fe80::be24:11ff:fe46:9189"
              ],
              [],
              [
                "fe80::a81c:adff:fe65:df"
              ],
              [
                "fe80::f090:c0ff:fe6d:8158"
              ],
              [
                "fe80::6804:c3ff:fee4:4c52"
              ],
              [
                "fe80::84ba:d7ff:feac:d4f9"
              ]
            ],
            "keyboard_layout": "en-us",
            "kvm_arguments": null,
            "mac_addresses": [
              "00:00:00:00:00:00",
              "BC:24:11:46:91:89",
              "22:39:B2:8F:D7:DE",
              "AA:1C:AD:65:00:DF",
              "F2:90:C0:6D:81:58",
              "6A:04:C3:E4:4C:52",
              "86:BA:D7:AC:D4:F9"
            ],
            "machine": "q35",
            "memory": [
              {
                "dedicated": 4096,
                "floating": 0,
                "hugepages": "",
                "keep_hugepages": false,
                "shared": 0
              }
            ],
            "migrate": false,
            "name": "infisical",
            "network_device": [
              {
                "bridge": "vmbr0",
                "disconnected": false,
                "enabled": true,
                "firewall": false,
                "mac_address": "BC:24:11:46:91:89",
                "model": "virtio",
                "mtu": 0,
                "queues": 0,
                "rate_limit": 0,
                "trunks": "",
                "vlan_id": 0
              }
            ],
            "network_interface_names": [
              "lo",
              "eth0",
              "docker0",
              "br-2ec6d8156e0c",
              "veth2e8597c",
              "vethe38e0ef",
              "veth1c3cbfb"
            ],
            "node_name": "server",
            "numa": [],
            "on_boot": true,
            "operating_system": [
              {
                "type": "l26"
              }
            ],
            "pool_id": "",
            "protection": false,
            "purge_on_destroy": true,
            "reboot": false,
            "reboot_after_update": true,
            "rng": [],
            "scsi_hardware": "virtio-scsi-single",
            "serial_device": [],
            "smbios": [],
            "started": true,
            "startup": [
              {
                "down_delay": 60,
                "order": 2,
                "up_delay": 60
              }
            ],
            "stop_on_destroy": false,
            "tablet_device": true,
            "tags": [
              "infisical",
              "secrets"
            ],
            "template": false,
            "timeout_clone": 1800,
            "timeout_create": 1800,
            "timeout_migrate": 1800,
            "timeout_move_disk": 1800,
            "timeout_reboot": 1800,
            "timeout_shutdown_vm": 1800,
            "timeout_start_vm": 1800,
            "timeout_stop_vm": 300,
            "tpm_state": [],
            "usb": [],
            "vga": [],
            "virtiofs": [],
            "vm_id": 114,
            "watchdog": []
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "initialization"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "user_account"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "password"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA==",
          "dependencies": [
            "proxmox_virtual_environment_file.infisical_cloud_init",
            "proxmox_virtual_environment_vm.db_postgres"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_vm",
      "name": "k3s_apps",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acpi": true,
            "agent": [],
            "amd_sev": [],
            "audio_device": [],
            "bios": "ovmf",
            "boot_order": [
              "scsi0"
            ],
            "cdrom": [],
            "clone": [
              {
                "datastore_id": "",
                "full": true,
                "node_name": "server",
                "retries": 1,
                "vm_id": 9001
              }
            ],
            "cpu": [
              {
                "affinity": "",
                "architecture": "",
                "cores": 8,
                "flags": [],
                "hotplugged": 0,
                "limit": 0,
                "numa": false,
                "sockets": 1,
                "type": "host",
                "units": 0
              }
            ],
            "delete_unreferenced_disks_on_destroy": true,
            "description": "K3s single-node cluster host",
            "disk": [
              {
                "aio": "io_uring",
                "backup": true,
                "cache": "none",
                "datastore_id": "local-lvm",
                "discard": "ignore",
                "file_format": "raw",
                "file_id": "",
                "import_from": "",
                "interface": "scsi0",
                "iothread": false,
                "path_in_datastore": "vm-112-disk-1",
                "replicate": true,
                "serial": "",
                "size": 80,
                "speed": [],
                "ssd": false
              }
            ],
            "efi_disk": [],
            "hook_script_file_id": null,
            "hostpci": [],
            "id": "112",
            "initialization": [
              {
                "datastore_id": "local-lvm",
                "dns": [
                  {
                    "domain": "",
                    "servers": [
                      "1.1.1.1"
                    ]
                  }
                ],
                "file_format": "",
                "interface": "ide2",
                "ip_config": [
                  {
                    "ipv4": [
                      {
                        "address": "192.168.20.11/24",
                        "gateway": "192.168.20.1"
                      }
                    ],
                    "ipv6": []
                  }
                ],
                "meta_data_file_id": "",
                "network_data_file_id": "",
                "type": "",
                "user_account": [
                  {
                    "keys": [
                      "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAhLzivPgJGOMkfj6Fg8WBbPvJIMLQHjpFTnXZVsncBg prakash2ji@gmail.com"
                    ],
                    "password": "**********",
                    "username": "deployer"
                  }
                ],
                "user_data_file_id": "",
                "vendor_data_file_id": ""
              }
            ],
            "ipv4_addresses": [
              [
                "127.0.0.1"
              ],
              [
                "192.168.20.11"
              ],
              [
                "10.42.0.0"
              ],
              [
                "10.42.0.1"
              ],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              []
            ],
            "ipv6_addresses": [
              [
                "::1"
              ],
              [
                "fdd5:945b:3322::a69",
                "fdd5:945b:3322:0:be24:11ff:fea4:aa84",
                "fe80::be24:11ff:fea4:aa84"
              ],
              [
                "fe80::c85d:feff:fe8e:5808"
              ],
              [
                "fe80::14b5:89ff:fe2c:2ed3"
              ],
              [
                "fe80::bcc3:a4ff:fee1:46f6"
              ],
              [
                "fe80::9cdc:eff:fe2e:5dd4"
              ],
              [
                "fe80::8063:37ff:feba:654d"
              ],
              [
                "fe80::d808:80ff:fefc:45d"
              ],
              [
                "fe80::f460:f8ff:fe92:e28d"
              ],
              [
                "fe80::8441:31ff:fe8c:e0a"
              ],
              [
                "fe80::e48f:39ff:fed1:6b4e"
              ],
              [
                "fe80::9099:edff:fe24:ac16"
              ],
              [
                "fe80::3073:1cff:fe1b:d6e"
              ],
              [
                "fe80::8898:dfff:fe98:2e5a"
              ],
              [
                "fe80::9cc8:25ff:fefe:a614"
              ],
              [
                "fe80::78e6:9ff:febe:291e"
              ],
              [
                "fe80::4c7a:84ff:febc:34ff"
              ],
              [
                "fe80::fcc6:11ff:fe48:6448"
              ],
              [
                "fe80::6ca5:c6ff:feec:79ce"
              ],
              [
                "fe80::20b2:56ff:fe44:f596"
              ],
              [
                "fe80::e0b6:bff:fe01:4355"
              ],
              [
                "fe80::f0c4:1bff:fe31:1634"
              ],
              [
                "fe80::5099:a0ff:fe86:4723"
              ],
              [
                "fe80::bc67:ebff:fed7:c4cc"
              ]
            ],
            "keyboard_layout": "en-us",
            "kvm_arguments": null,
            "mac_addresses": [
              "00:00:00:00:00:00",
              "BC:24:11:A4:AA:84",
              "CA:5D:FE:8E:58:08",
              "16:B5:89:2C:2E:D3",
              "BE:C3:A4:E1:46:F6",
              "9E:DC:0E:2E:5D:D4",
              "82:63:37:BA:65:4D",
              "DA:08:80:FC:04:5D",
              "F6:60:F8:92:E2:8D",
              "86:41:31:8C:0E:0A",
              "E6:8F:39:D1:6B:4E",
              "92:99:ED:24:AC:16",
              "32:73:1C:1B:0D:6E",
              "8A:98:DF:98:2E:5A",
              "9E:C8:25:FE:A6:14",
              "7A:E6:09:BE:29:1E",
              "4E:7A:84:BC:34:FF",
              "FE:C6:11:48:64:48",
              "6E:A5:C6:EC:79:CE",
              "22:B2:56:44:F5:96",
              "E2:B6:0B:01:43:55",
              "F2:C4:1B:31:16:34",
              "52:99:A0:86:47:23",
              "BE:67:EB:D7:C4:CC"
            ],
            "machine": "q35",
            "memory": [
              {
                "dedicated": 12288,
                "floating": 0,
                "hugepages": "",
                "keep_hugepages": false,
                "shared": 0
              }
            ],
            "migrate": false,
            "name": "k3s-apps",
            "network_device": [
              {
                "bridge": "vmbr0",
                "disconnected": false,
                "enabled": true,
                "firewall": false,
                "mac_address": "BC:24:11:A4:AA:84",
                "model": "virtio",
                "mtu": 0,
                "queues": 0,
                "rate_limit": 0,
                "trunks": "",
                "vlan_id": 0
              }
            ],
            "network_interface_names": [
              "lo",
              "eth0",
              "flannel.1",
              "cni0",
              "vethb3e5761f",
              "veth84446737",
              "veth94da0a8b",
              "veth696c0224",
              "veth8f2a25c8",
              "vethf743a188",
              "veth716370ea",
              "veth6b0ed73f",
              "vethb41d3514",
              "veth77c1adb3",
              "veth9ba84e81",
              "vethb31b9b08",
              "vethfe3add83",
              "vethf5600c86",
              "vethd73cbe9e",
              "vethe4510d4e",
              "veth5fda9ca2",
              "veth6c7f45cf",
              "vethcb30ae42",
              "veth50556dfb"
            ],
            "node_name": "server",
            "numa": [],
            "on_boot": true,
            "operating_system": [
              {
                "type": "l26"
              }
            ],
            "pool_id": "",
            "protection": false,
            "purge_on_destroy": true,
            "reboot": false,
            "reboot_after_update": true,
            "rng": [],
            "scsi_hardware": "virtio-scsi-single",
            "serial_device": [],
            "smbios": [],
            "started": true,
            "startup": [
              {
                "down_delay": 60,
                "order": 1,
                "up_delay": 60
              }
            ],
            "stop_on_destroy": false,
            "tablet_device": true,
            "tags": [
              "apps",
              "k3s"
            ],
            "template": false,
            "timeout_clone": 1800,
            "timeout_create": 1800,
            "timeout_migrate": 1800,
            "timeout_move_disk": 1800,
            "timeout_reboot": 1800,
            "timeout_shutdown_vm": 1800,
            "timeout_start_vm": 1800,
            "timeout_stop_vm": 300,
            "tpm_state": [],
            "usb": [],
            "vga": [],
            "virtiofs": [],
            "vm_id": 112,
            "watchdog": []
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "initialization"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "user_account"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "password"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_vm",
      "name": "whisper_gpu",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acpi": true,
            "agent": [],
            "amd_sev": [],
            "audio_device": [],
            "bios": "ovmf",
            "boot_order": [
              "scsi0"
            ],
            "cdrom": [],
            "clone": [
              {
                "datastore_id": "",
                "full": true,
                "node_name": "server",
                "retries": 1,
                "vm_id": 9001
              }
            ],
            "cpu": [
              {
                "affinity": "",
                "architecture": "",
                "cores": 4,
                "flags": null,
                "hotplugged": 0,
                "limit": 0,
                "numa": false,
                "sockets": 1,
                "type": "host",
                "units": 0
              }
            ],
            "delete_unreferenced_disks_on_destroy": true,
            "description": "Whisper AI inference server with GPU passthrough",
            "disk": [
              {
                "aio": "io_uring",
                "backup": true,
                "cache": "none",
                "datastore_id": "local-lvm",
                "discard": "ignore",
                "file_format": "raw",
                "file_id": "",
                "import_from": "",
                "interface": "scsi0",
                "iothread": false,
                "path_in_datastore": "vm-115-disk-1",
                "replicate": true,
                "serial": "",
                "size": 50,
                "speed": [],
                "ssd": false
              }
            ],
            "efi_disk": [],
            "hook_script_file_id": null,
            "hostpci": [
              {
                "device": "hostpci0",
                "id": "",
                "mapping": "gpu-quadro-m4000",
                "mdev": "",
                "pcie": true,
                "rom_file": "",
                "rombar": true,
                "xvga": false
              }
            ],
            "id": "115",
            "initialization": [
              {
                "datastore_id": "local-lvm",
                "dns": [
                  {
                    "domain": "",
                    "servers": [
                      "1.1.1.1"
                    ]
                  }
                ],
                "file_format": "",
                "interface": "ide2",
                "ip_config": [
                  {
                    "ipv4": [
                      {
                        "address": "192.168.20.30/24",
                        "gateway": "192.168.20.1"
                      }
                    ],
                    "ipv6": []
                  }
                ],
                "meta_data_file_id": "",
                "network_data_file_id": "",
                "type": "",
                "user_account": [
                  {
                    "keys": [
                      "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAhLzivPgJGOMkfj6Fg8WBbPvJIMLQHjpFTnXZVsncBg prakash2ji@gmail.com"
                    ],
                    "password": "**********",
                    "username": "deployer"
                  }
                ],
                "user_data_file_id": "local:snippets/whisper-cloud-init.yaml",
                "vendor_data_file_id": ""
              }
            ],
            "ipv4_addresses": [
              [
                "127.0.0.1"
              ],
              [
                "192.168.20.30"
              ]
            ],
            "ipv6_addresses": [
              [
                "::1"
              ],
              [
                "fdd5:945b:3322::a69",
                "fdd5:945b:3322:0:be24:11ff:fe58:87a3",
                "fe80::be24:11ff:fe58:87a3"
              ]
            ],
            "keyboard_layout": "en-us",
            "kvm_arguments": null,
            "mac_addresses": [
              "00:00:00:00:00:00",
              "BC:24:11:58:87:A3"
            ],
            "machine": "q35",
            "memory": [
              {
                "dedicated": 16384,
                "floating": 0,
                "hugepages": "",
                "keep_hugepages": false,
                "shared": 0
              }
            ],
            "migrate": false,
            "name": "whisper-gpu",
            "network_device": [
              {
                "bridge": "vmbr0",
                "disconnected": false,
                "enabled": true,
                "firewall": false,
                "mac_address": "BC:24:11:58:87:A3",
                "model": "virtio",
                "mtu": 0,
                "queues": 0,
                "rate_limit": 0,
                "trunks": "",
                "vlan_id": 0
              }
            ],
            "network_interface_names": [
              "lo",
              "eth0"
            ],
            "node_name": "server",
            "numa": [],
            "on_boot": true,
            "operating_system": [
              {
                "type": "l26"
              }
            ],
            "pool_id": "",
            "protection": false,
            "purge_on_destroy": true,
            "reboot": false,
            "reboot_after_update": true,
            "rng": [],
            "scsi_hardware": "virtio-scsi-single",
            "serial_device": [],
            "smbios": [],
            "started": true,
            "startup": [
              {
                "down_delay": 60,
                "order": 3,
                "up_delay": 120
              }
            ],
            "stop_on_destroy": false,
            "tablet_device": true,
            "tags": [
              "gpu",
              "ml",
              "whisper"
            ],
            "template": false,
            "timeout_clone": 1800,
            "timeout_create": 1800,
            "timeout_migrate": 1800,
            "timeout_move_disk": 1800,
            "timeout_reboot": 1800,
            "timeout_shutdown_vm": 1800,
            "timeout_start_vm": 1800,
            "timeout_stop_vm": 300,
            "tpm_state": [],
            "usb": [],
            "vga": [],
            "virtiofs": [],
            "vm_id": 115,
            "watchdog": []
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "initialization"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "user_account"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "password"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA==",
          "dependencies": [
            "proxmox_virtual_environment_file.whisper_cloud_init"
          ]
        }
      ]
    }
  ],
  "check_results": null
}
