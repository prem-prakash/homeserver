{
  "version": 4,
  "terraform_version": "1.14.3",
  "serial": 164,
  "lineage": "e05b919b-edf6-d388-fe7d-2f0d5cdf29f8",
  "outputs": {
    "db_vm_ip": {
      "value": "192.168.20.21",
      "type": "string"
    },
    "infisical_url": {
      "value": "https://192.168.20.22:8443",
      "type": "string"
    },
    "infisical_vm_ip": {
      "value": "192.168.20.22",
      "type": "string"
    },
    "k3s_vm_ip": {
      "value": "192.168.20.11",
      "type": "string"
    },
    "whisper_api_url": {
      "value": "http://192.168.20.30:8000",
      "type": "string"
    },
    "whisper_vm_ip": {
      "value": "192.168.20.30",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_file",
      "name": "infisical_cloud_init",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content_type": "snippets",
            "datastore_id": "local",
            "file_mode": null,
            "file_modification_date": null,
            "file_name": "infisical-cloud-init.yaml",
            "file_size": null,
            "file_tag": null,
            "id": "local:snippets/infisical-cloud-init.yaml",
            "node_name": "server",
            "overwrite": true,
            "source_file": [],
            "source_raw": [
              {
                "data": "#cloud-config\n\n# Set hostname early (before packages install)\nhostname: infisical\nmanage_etc_hosts: true\n\npackage_update: true\npackage_upgrade: true\n\npackages:\n  - ca-certificates\n  - curl\n  - gnupg\n  - avahi-daemon\n\nwrite_files:\n  - path: /opt/infisical/docker-compose.yml\n    permissions: '0644'\n    content: |\n      version: \"3.9\"\n\n      services:\n        redis:\n          image: redis:7-alpine\n          container_name: infisical-redis\n          restart: unless-stopped\n          volumes:\n            - redis_data:/data\n          healthcheck:\n            test: [\"CMD\", \"redis-cli\", \"ping\"]\n            interval: 10s\n            timeout: 5s\n            retries: 5\n\n        infisical:\n          image: infisical/infisical:latest\n          container_name: infisical\n          restart: unless-stopped\n          ports:\n            - \"8080:8080\"\n          environment:\n            - NODE_ENV=production\n            - ENCRYPTION_KEY=34d19614f7de46fec34763e98cb1648d\n            - AUTH_SECRET=+tXmLH8ByVq0x2YyAPg7jB4OHW6n9HsmL8ZJIkoPvbw=\n            - DB_CONNECTION_URI=postgres://infisical:laEBe7ZLvNPBADCvYH9ei4mQz3ZVk%2FWN@192.168.20.21:5432/infisical\n            - REDIS_URL=redis://redis:6379\n            - SITE_URL=https://192.168.20.22:8443\n            - TELEMETRY_ENABLED=false\n          depends_on:\n            redis:\n              condition: service_healthy\n          healthcheck:\n            test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8080/api/status\"]\n            interval: 30s\n            timeout: 10s\n            retries: 5\n\n        nginx:\n          image: nginx:alpine\n          container_name: infisical-nginx\n          restart: unless-stopped\n          ports:\n            - \"443:443\"\n          volumes:\n            - ./nginx.conf:/etc/nginx/nginx.conf:ro\n            - ./certs:/etc/nginx/certs:ro\n          depends_on:\n            - infisical\n          healthcheck:\n            test: [\"CMD\", \"wget\", \"-q\", \"--spider\", \"http://localhost:80/health\"]\n            interval: 30s\n            timeout: 10s\n            retries: 3\n\n      volumes:\n        redis_data:\n\n      networks:\n        default:\n          name: infisical-network\n\n  - path: /opt/infisical/.env\n    permissions: '0600'\n    content: |\n      # Infisical environment - managed by Terraform\n      ENCRYPTION_KEY=34d19614f7de46fec34763e98cb1648d\n      AUTH_SECRET=+tXmLH8ByVq0x2YyAPg7jB4OHW6n9HsmL8ZJIkoPvbw=\n      POSTGRES_HOST=192.168.20.21\n      POSTGRES_PORT=5432\n      POSTGRES_DB=infisical\n      POSTGRES_USER=infisical\n      POSTGRES_PASSWORD=laEBe7ZLvNPBADCvYH9ei4mQz3ZVk/WN\n\n  - path: /opt/infisical/nginx.conf\n    permissions: '0644'\n    content: |\n      events {\n          worker_connections 1024;\n      }\n\n      http {\n          upstream infisical {\n              server infisical:8080;\n          }\n\n          server {\n              listen 80;\n              location /health {\n                  return 200 'ok';\n                  add_header Content-Type text/plain;\n              }\n              location / {\n                  return 301 https://$host$request_uri;\n              }\n          }\n\n          server {\n              listen 443 ssl;\n              server_name infisical.local;\n\n              ssl_certificate /etc/nginx/certs/cert.pem;\n              ssl_certificate_key /etc/nginx/certs/key.pem;\n              ssl_protocols TLSv1.2 TLSv1.3;\n              ssl_ciphers HIGH:!aNULL:!MD5;\n\n              location / {\n                  proxy_pass http://infisical;\n                  proxy_set_header Host $host;\n                  proxy_set_header X-Real-IP $remote_addr;\n                  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                  proxy_set_header X-Forwarded-Proto $scheme;\n\n                  # WebSocket support\n                  proxy_http_version 1.1;\n                  proxy_set_header Upgrade $http_upgrade;\n                  proxy_set_header Connection \"upgrade\";\n              }\n          }\n      }\n\n  - path: /etc/systemd/system/infisical.service\n    permissions: '0644'\n    content: |\n      [Unit]\n      Description=Infisical Secret Management\n      Requires=docker.service\n      After=docker.service\n\n      [Service]\n      Type=oneshot\n      RemainAfterExit=yes\n      WorkingDirectory=/opt/infisical\n      ExecStart=/usr/bin/docker compose up -d\n      ExecStop=/usr/bin/docker compose down\n\n      [Install]\n      WantedBy=multi-user.target\n\n  - path: /opt/infisical/certs/cert.pem\n    permissions: '0644'\n    content: |\n      -----BEGIN CERTIFICATE-----\n      MIIElDCCAvygAwIBAgIRAPRhVyAQwX8KazirE3Zrzc0wDQYJKoZIhvcNAQELBQAw\n      gakxHjAcBgNVBAoTFW1rY2VydCBkZXZlbG9wbWVudCBDQTE/MD0GA1UECww2cHJh\n      a2FzaEBNYWNCb29rLVByby1NMy1kZS1QcmFrYXNoLmxvY2FsIChQcmFrYXNoIFBy\n      ZW0pMUYwRAYDVQQDDD1ta2NlcnQgcHJha2FzaEBNYWNCb29rLVByby1NMy1kZS1Q\n      cmFrYXNoLmxvY2FsIChQcmFrYXNoIFByZW0pMB4XDTI2MDExMDE2NDEyOFoXDTI4\n      MDQxMDE2NDEyOFowajEnMCUGA1UEChMebWtjZXJ0IGRldmVsb3BtZW50IGNlcnRp\n      ZmljYXRlMT8wPQYDVQQLDDZwcmFrYXNoQE1hY0Jvb2stUHJvLU0zLWRlLVByYWth\n      c2gubG9jYWwgKFByYWthc2ggUHJlbSkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw\n      ggEKAoIBAQCukN/HYCeZp2W7MRhHZNaiWlzvYm85hkdkXXCspwOcCGOupDAUKIlO\n      ygVxueXJQQE0X4G3TmWFePldRMyhPQSzN9q/R6WC5+omvWHe5mnRx4zqauwNrEF9\n      ELgwVaqzKVpyQHo556KgfrEbMSO7cVdSQuPmIGA9+AHQbc9f2Z3z17sntTTbvNaX\n      668Zjl5K/h5eqAZHrdNc2VHtUTVEqdtPW5t8ySZ6Zxqq4SrEavMSX8HfI3FBe4u0\n      8R28Ivr6a09qbXlDfgdq+blRcMYnK2eeAmKFgB2woOW7wj/TCMzTm95TIHXrhwep\n      t88rzLVUm6TcP3s2MaMMTSqLEXP/wGXPAgMBAAGjdTBzMA4GA1UdDwEB/wQEAwIF\n      oDATBgNVHSUEDDAKBggrBgEFBQcDATAfBgNVHSMEGDAWgBTBE5p1B2rilKWfz3pV\n      699bwgJ/ADArBgNVHREEJDAigg9pbmZpc2ljYWwubG9jYWyCCWxvY2FsaG9zdIcE\n      wKgUFjANBgkqhkiG9w0BAQsFAAOCAYEAAgaDIpHFZGHpDe+lfW2N6/rV+S4BjMqK\n      pio83jQc6pwrsrHRj4aGI/IxywsPBr7jIm5W8Mcpk7Hn4+aaiJap6agyqKrvCKiz\n      SsCVVuz/9UR0LDqJ+AxscgFaC/3q3bNTJ4FxP3KimsItoB6vEuKQ0n67jLuNcZQo\n      yfReZxppdi7PX1CG4dqMKDxRMV62GOiTU4c8Puqbvjg3pSF9nM9j7/hV5mbxh0UB\n      2wwIab2+x1uEHEP8ESM7RWKm92RbLg+kVOnoWigfn2/wITS+Kf6k2vV/TXSQJyrL\n      Rdk9M0YSa9gO68GC3KTwu7qVHjfoxOXo51nuZsEZi9mWMYaghSa0c2ptm66Bb7f+\n      u+l2SNPBqmMWzW6Au6PFmM8AbEfynrTNpPM+aEiep4psb8UxRjlmoonzmauHFS5c\n      imbrDfOzT+WH+C9wZDrEPxwewWvpv9C/qAuN72QoinebBb0rKrPqutDoPJ7dKQtH\n      uw7wfPhQQ8gYY8tPXQ+3TEtKkvSZuUzb\n      -----END CERTIFICATE-----\n      \n\n  - path: /opt/infisical/certs/key.pem\n    permissions: '0600'\n    content: |\n      -----BEGIN PRIVATE KEY-----\n      MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCukN/HYCeZp2W7\n      MRhHZNaiWlzvYm85hkdkXXCspwOcCGOupDAUKIlOygVxueXJQQE0X4G3TmWFePld\n      RMyhPQSzN9q/R6WC5+omvWHe5mnRx4zqauwNrEF9ELgwVaqzKVpyQHo556KgfrEb\n      MSO7cVdSQuPmIGA9+AHQbc9f2Z3z17sntTTbvNaX668Zjl5K/h5eqAZHrdNc2VHt\n      UTVEqdtPW5t8ySZ6Zxqq4SrEavMSX8HfI3FBe4u08R28Ivr6a09qbXlDfgdq+blR\n      cMYnK2eeAmKFgB2woOW7wj/TCMzTm95TIHXrhwept88rzLVUm6TcP3s2MaMMTSqL\n      EXP/wGXPAgMBAAECggEAAdXx0ZW96TrsyWbh8u76oEu4Pqd6nZZWiyFgyPRhB8rv\n      4iV0DFgJ4CfHhw8XTuI32AZVFyap/hkO8Ssl9NR6zVryYAl7TF3vELOXI0Cpl6uc\n      6AVyMGaesgvnazn58aiPwqhdSWj2ojX7leYSqdl/6gi5fytk5j8EyAwPkwiOXMLk\n      MJOvcGqJ0gJtqO8+SINtEq+U1Qmti++fSchZvxrXgvpvqYWFsuBEFK8BbbnuBkB9\n      3+LPYV/dhUqIBhhwPJqemKo+UQPY0tkpka2aRoiTUuEnqs8LhD66RA8LSIUsLFsV\n      07OniGx4F20Sp+R1Q0GUvBUnSA1gYW54DOoR9h+GGQKBgQDjwNJORDrdkYq6Y4FY\n      atE7+KTx7wBDWCTTL36nJQBqfDhtVcdIJtD17NIFv1hPzXv1XaygoURQRoq5WZXo\n      mbE/Y6pQmWQjnXjpy8YYgi2MzrVChO0RNhDFGMelHBRF054IYi6UjwNxy/UJxSuI\n      MQst64Xe4/0c/sVGbRHdUu7KswKBgQDEN1pM+XHyM+hjvh+vAwf+aywEafsMDxOs\n      UFf7KYpHl7Cz/j9hb+5265S5s46pR6t1pcf/QmH9CUcBYP6uX4fgI1s50wB0WCmQ\n      +W3pdzkSBXUJ/6JtfVe2g34kJWDNWKxaBZntWp9Jc/hdgflBPHE7ZWdIVGRhwV70\n      DHYg/LQ2dQKBgH22/p8DHHcXEjtmF4yFka8HxYxhv4Rs0A7eRYvfacZdgQwg8BpM\n      isVkjl1rzERoiUbcCSC1Q68H8ST0ZUH6LBNwYR+SO+tIzehHebYnjRsPMpBgLTd1\n      33XcAr+Jq0sLz0yTXWDVPDKBQWW+NxQ69g/H1KI+uIVbv+rq45SGZZbvAoGBAKRL\n      YN4RA9r0ocJaoLbvB9N9M2ciwmWPfj6LK5APcUyO9BNScQmKKpcCnQ59DZgqfaPN\n      w0+16sxv5zd9WuLw9Jm1oR4i0j+Yzn0ojWKuRGgVj7Fmjj+1cytMoONtNMfcVrwt\n      8nwupC9h3nWVbfq0vG8qcje7Ci5cNsCMaqEmV1M9AoGBALNNB2VWkppOvhkLqslp\n      CafOEeG3nlGyBDwJnFBB2GDSANWuhXVEFd4yQwQVzreNnqGRgI8FE+bZWN3UuUDf\n      LcucvXnjkqz1GhTAHcysBQAk5WvYQw4q38/FU3/jkbWb9RoIDFI79q5CSqM3QYIJ\n      vV0zti7tCdj4t4c2YGgIsaQs\n      -----END PRIVATE KEY-----\n      \n\nruncmd:\n  # Ensure avahi is enabled (hostname already set via cloud-init)\n  - systemctl enable avahi-daemon\n  - systemctl restart avahi-daemon\n\n  # Install Docker\n  - install -m 0755 -d /etc/apt/keyrings\n  - curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc\n  - chmod a+r /etc/apt/keyrings/docker.asc\n  - echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian $(. /etc/os-release \u0026\u0026 echo \"$VERSION_CODENAME\") stable\" | tee /etc/apt/sources.list.d/docker.list \u003e /dev/null\n  - apt-get update\n  - apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n\n  # Add deployer user to docker group\n  - usermod -aG docker deployer\n\n  # Enable and start Docker\n  - systemctl enable docker\n  - systemctl start docker\n\n  # Wait for Docker to be ready\n  - sleep 10\n\n  # Enable and start Infisical\n  - systemctl daemon-reload\n  - systemctl enable infisical\n  - systemctl start infisical\n\nfinal_message: \"Infisical server is ready! Access at https://$INSTANCE_IP:8443\"\n",
                "file_name": "infisical-cloud-init.yaml",
                "resize": 0
              }
            ],
            "timeout_upload": 1800
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "source_raw"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "data"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_file",
      "name": "whisper_cloud_init",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content_type": "snippets",
            "datastore_id": "local",
            "file_mode": null,
            "file_modification_date": null,
            "file_name": "whisper-cloud-init.yaml",
            "file_size": null,
            "file_tag": null,
            "id": "local:snippets/whisper-cloud-init.yaml",
            "node_name": "server",
            "overwrite": true,
            "source_file": [],
            "source_raw": [
              {
                "data": "#cloud-config\n# Whisper GPU Inference Server\n# Requires: debian-12-nvidia template (NVIDIA drivers pre-installed)\n# Sets up: Python environment, PyTorch with CUDA, Whisper API\n\nhostname: whisper\nmanage_etc_hosts: true\n\npackage_update: true\npackage_upgrade: false\n\npackages:\n  - build-essential\n  - python3\n  - python3-pip\n  - python3-venv\n  - git\n  - curl\n  - wget\n  - htop\n  - ffmpeg\n  - libsndfile1\n  - unzip\n  - avahi-daemon\n\nusers:\n  - default\n  - name: whisper\n    groups: [sudo, video, render]\n    shell: /bin/bash\n    sudo: ALL=(ALL) NOPASSWD:ALL\n\nwrite_files:\n  # Main setup script - runs once on first boot\n  - path: /opt/whisper/setup.sh\n    permissions: \"0755\"\n    content: |\n      #!/bin/bash\n      # Whisper API Setup Script\n      # NVIDIA drivers are pre-installed in the template\n\n      LOG_FILE=\"/var/log/whisper-setup.log\"\n      exec \u003e \u003e(tee -a \"$LOG_FILE\") 2\u003e\u00261\n\n      echo \"\"\n      echo \"==========================================\"\n      echo \"Whisper Setup - $(date)\"\n      echo \"==========================================\"\n\n      SETUP_COMPLETE=\"/opt/whisper/.setup_complete\"\n\n      # If setup is complete, exit\n      if [ -f \"$SETUP_COMPLETE\" ]; then\n          echo \"Setup already complete.\"\n          exit 0\n      fi\n\n      # Ensure ownership\n      chown -R whisper:whisper /opt/whisper\n\n      # Verify GPU is available\n      echo \"\"\n      echo \"=== Checking GPU ===\"\n      if ! nvidia-smi; then\n          echo \"ERROR: NVIDIA GPU not detected!\"\n          echo \"Make sure you're using the debian-12-nvidia template\"\n          echo \"and GPU passthrough is configured correctly.\"\n          exit 1\n      fi\n\n      echo \"\"\n      echo \"GPU detected:\"\n      nvidia-smi --query-gpu=name,memory.total,driver_version --format=csv\n\n      # Setup Python environment\n      echo \"\"\n      echo \"=== Setting up Python environment ===\"\n      sudo -u whisper /opt/whisper/setup-python.sh\n\n      # Start service\n      echo \"\"\n      echo \"=== Starting Whisper API service ===\"\n\n      chown -R whisper:whisper /opt/whisper\n\n      systemctl daemon-reload\n      systemctl enable whisper-api\n      systemctl start whisper-api\n\n      # Wait for service to start\n      sleep 5\n\n      # Verify service is running\n      if systemctl is-active --quiet whisper-api; then\n          touch \"$SETUP_COMPLETE\"\n          chown whisper:whisper \"$SETUP_COMPLETE\"\n\n          echo \"\"\n          echo \"==========================================\"\n          echo \"SETUP COMPLETE!\"\n          echo \"==========================================\"\n          echo \"\"\n          echo \"Whisper API: http://$(hostname -I | awk '{print $1}'):8000\"\n          echo \"Health check: curl http://$(hostname -I | awk '{print $1}'):8000/health\"\n          echo \"\"\n\n          # Disable setup service\n          systemctl disable whisper-setup.service\n      else\n          echo \"ERROR: whisper-api service failed to start\"\n          journalctl -u whisper-api -n 20 --no-pager\n          exit 1\n      fi\n\n  # Systemd service for setup (runs once on first boot)\n  - path: /etc/systemd/system/whisper-setup.service\n    permissions: \"0644\"\n    content: |\n      [Unit]\n      Description=Whisper API Setup\n      After=network-online.target\n      Wants=network-online.target\n\n      [Service]\n      Type=oneshot\n      ExecStart=/opt/whisper/setup.sh\n      RemainAfterExit=yes\n      StandardOutput=journal+console\n      StandardError=journal+console\n\n      [Install]\n      WantedBy=multi-user.target\n\n  # Python setup script\n  - path: /opt/whisper/setup-python.sh\n    permissions: \"0755\"\n    content: |\n      #!/bin/bash\n      set -e\n\n      echo \"Setting up Python environment...\"\n\n      cd /opt/whisper\n\n      # Create virtual environment\n      python3 -m venv venv\n      source venv/bin/activate\n\n      # Upgrade pip\n      pip install --upgrade pip wheel setuptools\n\n      # Install PyTorch 2.0.1 with CUDA 11.8 - supports Maxwell GPUs (sm_52)\n      echo \"Installing PyTorch with CUDA support...\"\n      pip install torch==2.0.1+cu118 --index-url https://download.pytorch.org/whl/cu118\n\n      # Install requirements\n      pip install -r requirements.txt\n\n      # Download the turbo model\n      echo \"Downloading Whisper turbo model...\"\n      python3 -c \"\n      import whisper\n      print('Downloading turbo model...')\n      model = whisper.load_model('turbo', device='cpu')\n      print('Model downloaded successfully!')\n      \"\n\n      echo \"Python setup complete!\"\n\n  # Requirements file\n  - path: /opt/whisper/requirements.txt\n    permissions: \"0644\"\n    content: |\n      numpy\u003c2\n      openai-whisper\n      fastapi\u003e=0.109.0\n      uvicorn[standard]\u003e=0.27.0\n      python-multipart\u003e=0.0.6\n      pydantic\u003e=2.0.0\n\n  # Whisper API service\n  - path: /opt/whisper/api.py\n    permissions: \"0644\"\n    content: |\n      #!/usr/bin/env python3\n      \"\"\"\n      Whisper Transcription API\n      GPU-accelerated speech-to-text using OpenAI Whisper\n      \"\"\"\n      import os\n      import tempfile\n      import time\n      from pathlib import Path\n      from typing import Optional\n\n      from fastapi import FastAPI, File, UploadFile, HTTPException, Query\n      from pydantic import BaseModel\n      import uvicorn\n      import torch\n\n      app = FastAPI(\n          title=\"Whisper Transcription API\",\n          description=\"GPU-accelerated speech-to-text using OpenAI Whisper\",\n          version=\"2.0.0\"\n      )\n\n      MODEL_NAME = os.getenv(\"WHISPER_MODEL\", \"turbo\")\n      DEVICE = os.getenv(\"WHISPER_DEVICE\", \"cuda\" if torch.cuda.is_available() else \"cpu\")\n\n      _model = None\n\n      def get_model():\n          global _model\n          if _model is None:\n              import whisper\n              print(f\"Loading Whisper model: {MODEL_NAME} on {DEVICE}\")\n              _model = whisper.load_model(MODEL_NAME, device=DEVICE)\n              print(\"Model loaded successfully!\")\n          return _model\n\n      class TranscriptionResponse(BaseModel):\n          text: str\n          language: str\n          duration: Optional[float] = None\n          processing_time: float\n          segments: Optional[list] = None\n\n      class HealthResponse(BaseModel):\n          status: str\n          model: str\n          device: str\n          gpu_available: bool\n          gpu_name: Optional[str] = None\n\n      @app.get(\"/health\", response_model=HealthResponse)\n      async def health_check():\n          gpu_available = torch.cuda.is_available()\n          gpu_name = torch.cuda.get_device_name(0) if gpu_available else None\n          return HealthResponse(\n              status=\"healthy\",\n              model=MODEL_NAME,\n              device=DEVICE,\n              gpu_available=gpu_available,\n              gpu_name=gpu_name\n          )\n\n      @app.post(\"/transcribe\", response_model=TranscriptionResponse)\n      async def transcribe(\n          file: UploadFile = File(...),\n          language: Optional[str] = Query(\"pt\", description=\"Language code (e.g., 'pt', 'en')\"),\n          include_segments: bool = Query(False),\n          task: str = Query(\"transcribe\"),\n          temperature: float = Query(0.0, description=\"Sampling temperature (0 = deterministic)\"),\n          best_of: int = Query(5, description=\"Number of candidates for beam search\")\n      ):\n          start_time = time.time()\n          allowed_extensions = {\".mp3\", \".wav\", \".m4a\", \".ogg\", \".flac\", \".webm\", \".mp4\", \".opus\"}\n          file_ext = Path(file.filename).suffix.lower() if file.filename else \"\"\n\n          if file_ext not in allowed_extensions:\n              raise HTTPException(status_code=400, detail=f\"Unsupported: {file_ext}\")\n\n          with tempfile.NamedTemporaryFile(delete=False, suffix=file_ext) as tmp:\n              content = await file.read()\n              tmp.write(content)\n              tmp_path = tmp.name\n\n          try:\n              model = get_model()\n              options = {\n                  \"task\": task,\n                  \"language\": language,\n                  \"temperature\": temperature,\n                  \"best_of\": best_of\n              }\n\n              result = model.transcribe(tmp_path, **options)\n\n              segments_list = None\n              if include_segments and \"segments\" in result:\n                  segments_list = [\n                      {\"start\": round(s[\"start\"], 2), \"end\": round(s[\"end\"], 2), \"text\": s[\"text\"].strip()}\n                      for s in result[\"segments\"]\n                  ]\n\n              return TranscriptionResponse(\n                  text=result[\"text\"].strip(),\n                  language=result.get(\"language\", \"unknown\"),\n                  processing_time=round(time.time() - start_time, 2),\n                  segments=segments_list\n              )\n          except Exception as e:\n              raise HTTPException(status_code=500, detail=str(e))\n          finally:\n              os.unlink(tmp_path)\n\n      @app.post(\"/transcribe/batch\")\n      async def transcribe_batch(\n          files: list[UploadFile] = File(...),\n          language: Optional[str] = Query(\"pt\", description=\"Language code (e.g., 'pt', 'en')\"),\n          include_segments: bool = Query(False),\n          task: str = Query(\"transcribe\"),\n          temperature: float = Query(0.0, description=\"Sampling temperature (0 = deterministic)\"),\n          best_of: int = Query(5, description=\"Number of candidates for beam search\")\n      ):\n          \"\"\"Transcribe multiple audio files in a single request.\"\"\"\n          start_time = time.time()\n          allowed_extensions = {\".mp3\", \".wav\", \".m4a\", \".ogg\", \".flac\", \".webm\", \".mp4\", \".opus\"}\n          model = get_model()\n\n          results = []\n          for file in files:\n              file_start = time.time()\n              file_ext = Path(file.filename).suffix.lower() if file.filename else \"\"\n\n              if file_ext not in allowed_extensions:\n                  results.append({\n                      \"filename\": file.filename,\n                      \"error\": f\"Unsupported file type: {file_ext}\"\n                  })\n                  continue\n\n              with tempfile.NamedTemporaryFile(delete=False, suffix=file_ext) as tmp:\n                  content = await file.read()\n                  tmp.write(content)\n                  tmp_path = tmp.name\n\n              try:\n                  options = {\n                      \"task\": task,\n                      \"language\": language,\n                      \"temperature\": temperature,\n                      \"best_of\": best_of\n                  }\n\n                  result = model.transcribe(tmp_path, **options)\n\n                  segments_list = None\n                  if include_segments and \"segments\" in result:\n                      segments_list = [\n                          {\"start\": round(s[\"start\"], 2), \"end\": round(s[\"end\"], 2), \"text\": s[\"text\"].strip()}\n                          for s in result[\"segments\"]\n                      ]\n\n                  results.append({\n                      \"filename\": file.filename,\n                      \"text\": result[\"text\"].strip(),\n                      \"language\": result.get(\"language\", \"unknown\"),\n                      \"processing_time\": round(time.time() - file_start, 2),\n                      \"segments\": segments_list\n                  })\n              except Exception as e:\n                  results.append({\n                      \"filename\": file.filename,\n                      \"error\": str(e)\n                  })\n              finally:\n                  os.unlink(tmp_path)\n\n          return {\n              \"total_files\": len(files),\n              \"total_processing_time\": round(time.time() - start_time, 2),\n              \"results\": results\n          }\n\n      if __name__ == \"__main__\":\n          print(\"Pre-loading Whisper model...\")\n          get_model()\n          print(\"Starting API server...\")\n          uvicorn.run(app, host=\"0.0.0.0\", port=8000)\n\n  # Systemd service for Whisper API\n  - path: /etc/systemd/system/whisper-api.service\n    permissions: \"0644\"\n    content: |\n      [Unit]\n      Description=Whisper Transcription API\n      After=network.target\n\n      [Service]\n      Type=simple\n      User=whisper\n      Group=whisper\n      WorkingDirectory=/opt/whisper\n      Environment=\"PATH=/opt/whisper/venv/bin:/usr/local/bin:/usr/bin:/bin\"\n      Environment=\"WHISPER_MODEL=turbo\"\n      Environment=\"WHISPER_DEVICE=cuda\"\n      ExecStart=/opt/whisper/venv/bin/python /opt/whisper/api.py\n      Restart=always\n      RestartSec=10\n      SupplementaryGroups=video render\n\n      [Install]\n      WantedBy=multi-user.target\n\n  # Promtail configuration for shipping logs to Loki\n  - path: /etc/promtail/config.yaml\n    permissions: \"0644\"\n    content: |\n      server:\n        http_listen_port: 9080\n        grpc_listen_port: 0\n\n      positions:\n        filename: /var/lib/promtail/positions.yaml\n\n      clients:\n        - url: http://192.168.20.11:31100/loki/api/v1/push\n\n      scrape_configs:\n        - job_name: whisper-api\n          journal:\n            max_age: 12h\n            labels:\n              job: whisper-api\n              host: whisper-gpu\n          relabel_configs:\n            - source_labels: ['__journal__systemd_unit']\n              regex: 'whisper-(api|setup)\\.service'\n              action: keep\n            - source_labels: ['__journal__systemd_unit']\n              target_label: unit\n            - source_labels: ['__journal_priority_keyword']\n              target_label: level\n\n        - job_name: system\n          journal:\n            max_age: 12h\n            labels:\n              job: system\n              host: whisper-gpu\n          relabel_configs:\n            - source_labels: ['__journal__systemd_unit']\n              regex: '(sshd|systemd-.*|nvidia-.*)\\.service'\n              action: keep\n            - source_labels: ['__journal__systemd_unit']\n              target_label: unit\n            - source_labels: ['__journal_priority_keyword']\n              target_label: level\n\n  # Systemd service for Promtail\n  - path: /etc/systemd/system/promtail.service\n    permissions: \"0644\"\n    content: |\n      [Unit]\n      Description=Promtail Log Collector\n      After=network-online.target whisper-api.service\n      Wants=network-online.target\n\n      [Service]\n      Type=simple\n      User=root\n      ExecStart=/usr/local/bin/promtail -config.file=/etc/promtail/config.yaml\n      Restart=always\n      RestartSec=10\n\n      [Install]\n      WantedBy=multi-user.target\n\n  # Promtail installation script\n  - path: /opt/whisper/install-promtail.sh\n    permissions: \"0755\"\n    content: |\n      #!/bin/bash\n      set -e\n\n      PROMTAIL_VERSION=\"3.6.3\"\n      ARCH=\"amd64\"\n\n      echo \"Installing Promtail ${PROMTAIL_VERSION}...\"\n\n      cd /tmp\n      wget -q \"https://github.com/grafana/loki/releases/download/v${PROMTAIL_VERSION}/promtail-linux-${ARCH}.zip\"\n      unzip -o \"promtail-linux-${ARCH}.zip\"\n      chmod +x \"promtail-linux-${ARCH}\"\n      mv \"promtail-linux-${ARCH}\" /usr/local/bin/promtail\n      rm -f \"promtail-linux-${ARCH}.zip\"\n\n      mkdir -p /var/lib/promtail\n      mkdir -p /etc/promtail\n\n      systemctl daemon-reload\n      systemctl enable promtail\n      systemctl start promtail\n\n      echo \"Promtail installed and started!\"\n\nruncmd:\n  - mkdir -p /opt/whisper/models\n  - chown -R whisper:whisper /opt/whisper\n  - echo \"Whisper cloud-init started at $(date)\" \u003e\u003e /var/log/whisper-setup.log\n  # Enable avahi for mDNS (whisper.local)\n  - systemctl enable avahi-daemon\n  - systemctl restart avahi-daemon\n  # Install Promtail for log shipping\n  - /opt/whisper/install-promtail.sh\n  # Enable and start setup service\n  - systemctl daemon-reload\n  - systemctl enable whisper-setup.service\n  - systemctl start whisper-setup.service\n",
                "file_name": "whisper-cloud-init.yaml",
                "resize": 0
              }
            ],
            "timeout_upload": 1800
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_vm",
      "name": "db_postgres",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acpi": true,
            "agent": [],
            "amd_sev": [],
            "audio_device": [],
            "bios": "ovmf",
            "boot_order": [
              "scsi0"
            ],
            "cdrom": [],
            "clone": [
              {
                "datastore_id": "",
                "full": true,
                "node_name": "server",
                "retries": 1,
                "vm_id": 9001
              }
            ],
            "cpu": [
              {
                "affinity": "",
                "architecture": "",
                "cores": 4,
                "flags": [],
                "hotplugged": 0,
                "limit": 0,
                "numa": false,
                "sockets": 1,
                "type": "host",
                "units": 0
              }
            ],
            "delete_unreferenced_disks_on_destroy": true,
            "description": "Postgres database host",
            "disk": [
              {
                "aio": "io_uring",
                "backup": true,
                "cache": "none",
                "datastore_id": "local-lvm",
                "discard": "ignore",
                "file_format": "raw",
                "file_id": "",
                "import_from": "",
                "interface": "scsi0",
                "iothread": false,
                "path_in_datastore": "vm-113-disk-1",
                "replicate": true,
                "serial": "",
                "size": 60,
                "speed": [],
                "ssd": false
              }
            ],
            "efi_disk": [],
            "hook_script_file_id": null,
            "hostpci": [],
            "id": "113",
            "initialization": [
              {
                "datastore_id": "local-lvm",
                "dns": [
                  {
                    "domain": "",
                    "servers": [
                      "1.1.1.1"
                    ]
                  }
                ],
                "file_format": "",
                "interface": "ide2",
                "ip_config": [
                  {
                    "ipv4": [
                      {
                        "address": "192.168.20.21/24",
                        "gateway": "192.168.20.1"
                      }
                    ],
                    "ipv6": []
                  }
                ],
                "meta_data_file_id": "",
                "network_data_file_id": "",
                "type": "",
                "user_account": [
                  {
                    "keys": [
                      "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAhLzivPgJGOMkfj6Fg8WBbPvJIMLQHjpFTnXZVsncBg prakash2ji@gmail.com"
                    ],
                    "password": "**********",
                    "username": "deployer"
                  }
                ],
                "user_data_file_id": "",
                "vendor_data_file_id": ""
              }
            ],
            "ipv4_addresses": [
              [
                "127.0.0.1"
              ],
              [
                "192.168.20.21"
              ]
            ],
            "ipv6_addresses": [
              [
                "::1"
              ],
              [
                "fdd5:945b:3322:0:be24:11ff:fe4c:ce72",
                "fe80::be24:11ff:fe4c:ce72"
              ]
            ],
            "keyboard_layout": "en-us",
            "kvm_arguments": null,
            "mac_addresses": [
              "00:00:00:00:00:00",
              "BC:24:11:4C:CE:72"
            ],
            "machine": "q35",
            "memory": [
              {
                "dedicated": 8192,
                "floating": 0,
                "hugepages": "",
                "keep_hugepages": false,
                "shared": 0
              }
            ],
            "migrate": false,
            "name": "db-postgres",
            "network_device": [
              {
                "bridge": "vmbr0",
                "disconnected": false,
                "enabled": true,
                "firewall": false,
                "mac_address": "BC:24:11:4C:CE:72",
                "model": "virtio",
                "mtu": 0,
                "queues": 0,
                "rate_limit": 0,
                "trunks": "",
                "vlan_id": 0
              }
            ],
            "network_interface_names": [
              "lo",
              "eth0"
            ],
            "node_name": "server",
            "numa": [],
            "on_boot": true,
            "operating_system": [
              {
                "type": "l26"
              }
            ],
            "pool_id": "",
            "protection": false,
            "purge_on_destroy": true,
            "reboot": false,
            "reboot_after_update": true,
            "rng": [],
            "scsi_hardware": "virtio-scsi-single",
            "serial_device": [],
            "smbios": [],
            "started": true,
            "startup": [
              {
                "down_delay": 60,
                "order": 1,
                "up_delay": 60
              }
            ],
            "stop_on_destroy": false,
            "tablet_device": true,
            "tags": [
              "db",
              "postgres"
            ],
            "template": false,
            "timeout_clone": 1800,
            "timeout_create": 1800,
            "timeout_migrate": 1800,
            "timeout_move_disk": 1800,
            "timeout_reboot": 1800,
            "timeout_shutdown_vm": 1800,
            "timeout_start_vm": 1800,
            "timeout_stop_vm": 300,
            "tpm_state": [],
            "usb": [],
            "vga": [],
            "virtiofs": [],
            "vm_id": 113,
            "watchdog": []
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "initialization"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "user_account"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "password"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_vm",
      "name": "infisical",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acpi": true,
            "agent": [],
            "amd_sev": [],
            "audio_device": [],
            "bios": "ovmf",
            "boot_order": [
              "scsi0"
            ],
            "cdrom": [],
            "clone": [
              {
                "datastore_id": "",
                "full": true,
                "node_name": "server",
                "retries": 1,
                "vm_id": 9001
              }
            ],
            "cpu": [
              {
                "affinity": "",
                "architecture": "",
                "cores": 2,
                "flags": [],
                "hotplugged": 0,
                "limit": 0,
                "numa": false,
                "sockets": 1,
                "type": "host",
                "units": 0
              }
            ],
            "delete_unreferenced_disks_on_destroy": true,
            "description": "Infisical secret management server",
            "disk": [
              {
                "aio": "io_uring",
                "backup": true,
                "cache": "none",
                "datastore_id": "local-lvm",
                "discard": "ignore",
                "file_format": "raw",
                "file_id": "",
                "import_from": "",
                "interface": "scsi0",
                "iothread": false,
                "path_in_datastore": "vm-114-disk-1",
                "replicate": true,
                "serial": "",
                "size": 20,
                "speed": [],
                "ssd": false
              }
            ],
            "efi_disk": [],
            "hook_script_file_id": null,
            "hostpci": [],
            "id": "114",
            "initialization": [
              {
                "datastore_id": "local-lvm",
                "dns": [
                  {
                    "domain": "",
                    "servers": [
                      "1.1.1.1"
                    ]
                  }
                ],
                "file_format": "",
                "interface": "ide2",
                "ip_config": [
                  {
                    "ipv4": [
                      {
                        "address": "192.168.20.22/24",
                        "gateway": "192.168.20.1"
                      }
                    ],
                    "ipv6": []
                  }
                ],
                "meta_data_file_id": "",
                "network_data_file_id": "",
                "type": "",
                "user_account": [
                  {
                    "keys": [
                      "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAhLzivPgJGOMkfj6Fg8WBbPvJIMLQHjpFTnXZVsncBg prakash2ji@gmail.com"
                    ],
                    "password": "**********",
                    "username": "deployer"
                  }
                ],
                "user_data_file_id": "local:snippets/infisical-cloud-init.yaml",
                "vendor_data_file_id": ""
              }
            ],
            "ipv4_addresses": [
              [
                "127.0.0.1"
              ],
              [
                "192.168.20.22"
              ],
              [
                "172.17.0.1"
              ],
              [
                "172.18.0.1"
              ],
              [],
              [],
              []
            ],
            "ipv6_addresses": [
              [
                "::1"
              ],
              [
                "fdd5:945b:3322:0:be24:11ff:fe46:9189",
                "fe80::be24:11ff:fe46:9189"
              ],
              [],
              [
                "fe80::906d:34ff:feaa:5944"
              ],
              [
                "fe80::f0cc:7eff:fe58:6704"
              ],
              [
                "fe80::58f1:9ff:fef4:b91f"
              ],
              [
                "fe80::e4e5:34ff:fe31:131"
              ]
            ],
            "keyboard_layout": "en-us",
            "kvm_arguments": null,
            "mac_addresses": [
              "00:00:00:00:00:00",
              "BC:24:11:46:91:89",
              "6A:5C:BF:1F:3D:73",
              "92:6D:34:AA:59:44",
              "F2:CC:7E:58:67:04",
              "5A:F1:09:F4:B9:1F",
              "E6:E5:34:31:01:31"
            ],
            "machine": "q35",
            "memory": [
              {
                "dedicated": 4096,
                "floating": 0,
                "hugepages": "",
                "keep_hugepages": false,
                "shared": 0
              }
            ],
            "migrate": false,
            "name": "infisical",
            "network_device": [
              {
                "bridge": "vmbr0",
                "disconnected": false,
                "enabled": true,
                "firewall": false,
                "mac_address": "BC:24:11:46:91:89",
                "model": "virtio",
                "mtu": 0,
                "queues": 0,
                "rate_limit": 0,
                "trunks": "",
                "vlan_id": 0
              }
            ],
            "network_interface_names": [
              "lo",
              "eth0",
              "docker0",
              "br-2cb89a95bc6e",
              "veth085ca6c",
              "veth86701f9",
              "vethfe4f51d"
            ],
            "node_name": "server",
            "numa": [],
            "on_boot": true,
            "operating_system": [
              {
                "type": "l26"
              }
            ],
            "pool_id": "",
            "protection": false,
            "purge_on_destroy": true,
            "reboot": false,
            "reboot_after_update": true,
            "rng": [],
            "scsi_hardware": "virtio-scsi-single",
            "serial_device": [],
            "smbios": [],
            "started": true,
            "startup": [
              {
                "down_delay": 60,
                "order": 2,
                "up_delay": 60
              }
            ],
            "stop_on_destroy": false,
            "tablet_device": true,
            "tags": [
              "infisical",
              "secrets"
            ],
            "template": false,
            "timeout_clone": 1800,
            "timeout_create": 1800,
            "timeout_migrate": 1800,
            "timeout_move_disk": 1800,
            "timeout_reboot": 1800,
            "timeout_shutdown_vm": 1800,
            "timeout_start_vm": 1800,
            "timeout_stop_vm": 300,
            "tpm_state": [],
            "usb": [],
            "vga": [],
            "virtiofs": [],
            "vm_id": 114,
            "watchdog": []
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "initialization"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "user_account"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "password"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA==",
          "dependencies": [
            "proxmox_virtual_environment_file.infisical_cloud_init",
            "proxmox_virtual_environment_vm.db_postgres"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_vm",
      "name": "k3s_apps",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acpi": true,
            "agent": [],
            "amd_sev": [],
            "audio_device": [],
            "bios": "ovmf",
            "boot_order": [
              "scsi0"
            ],
            "cdrom": [],
            "clone": [
              {
                "datastore_id": "",
                "full": true,
                "node_name": "server",
                "retries": 1,
                "vm_id": 9001
              }
            ],
            "cpu": [
              {
                "affinity": "",
                "architecture": "",
                "cores": 8,
                "flags": [],
                "hotplugged": 0,
                "limit": 0,
                "numa": false,
                "sockets": 1,
                "type": "host",
                "units": 0
              }
            ],
            "delete_unreferenced_disks_on_destroy": true,
            "description": "K3s single-node cluster host",
            "disk": [
              {
                "aio": "io_uring",
                "backup": true,
                "cache": "none",
                "datastore_id": "local-lvm",
                "discard": "ignore",
                "file_format": "raw",
                "file_id": "",
                "import_from": "",
                "interface": "scsi0",
                "iothread": false,
                "path_in_datastore": "vm-112-disk-1",
                "replicate": true,
                "serial": "",
                "size": 80,
                "speed": [],
                "ssd": false
              }
            ],
            "efi_disk": [],
            "hook_script_file_id": null,
            "hostpci": [],
            "id": "112",
            "initialization": [
              {
                "datastore_id": "local-lvm",
                "dns": [
                  {
                    "domain": "",
                    "servers": [
                      "1.1.1.1"
                    ]
                  }
                ],
                "file_format": "",
                "interface": "ide2",
                "ip_config": [
                  {
                    "ipv4": [
                      {
                        "address": "192.168.20.11/24",
                        "gateway": "192.168.20.1"
                      }
                    ],
                    "ipv6": []
                  }
                ],
                "meta_data_file_id": "",
                "network_data_file_id": "",
                "type": "",
                "user_account": [
                  {
                    "keys": [
                      "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAhLzivPgJGOMkfj6Fg8WBbPvJIMLQHjpFTnXZVsncBg prakash2ji@gmail.com"
                    ],
                    "password": "**********",
                    "username": "deployer"
                  }
                ],
                "user_data_file_id": "",
                "vendor_data_file_id": ""
              }
            ],
            "ipv4_addresses": [
              [
                "127.0.0.1"
              ],
              [
                "192.168.20.11"
              ],
              [
                "10.42.0.0"
              ],
              [
                "10.42.0.1"
              ],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              [],
              []
            ],
            "ipv6_addresses": [
              [
                "::1"
              ],
              [
                "fdd5:945b:3322::a69",
                "fdd5:945b:3322:0:be24:11ff:fea4:aa84",
                "fe80::be24:11ff:fea4:aa84"
              ],
              [
                "fe80::c85d:feff:fe8e:5808"
              ],
              [
                "fe80::14b5:89ff:fe2c:2ed3"
              ],
              [
                "fe80::248e:16ff:fed3:405f"
              ],
              [
                "fe80::2040:f3ff:fe91:8485"
              ],
              [
                "fe80::705a:39ff:fe9a:25a4"
              ],
              [
                "fe80::cc0a:c8ff:fe2c:f729"
              ],
              [
                "fe80::ec37:7aff:fe72:f123"
              ],
              [
                "fe80::800:8cff:fe91:686c"
              ],
              [
                "fe80::ecb5:21ff:fe1d:4638"
              ],
              [
                "fe80::480c:fcff:fe03:5c72"
              ],
              [
                "fe80::8cff:3dff:fed1:2b05"
              ],
              [
                "fe80::749c:b6ff:fe17:6101"
              ],
              [
                "fe80::3c70:6bff:fef8:a6c5"
              ],
              [
                "fe80::78e6:88ff:fef5:4a8d"
              ],
              [
                "fe80::4424:d7ff:feb2:52dd"
              ],
              [
                "fe80::ec84:59ff:fe42:50fe"
              ],
              [
                "fe80::1079:12ff:fef0:7517"
              ],
              [
                "fe80::584f:87ff:fe39:b601"
              ],
              [
                "fe80::946c:6aff:fe0e:28be"
              ],
              [
                "fe80::64c4:68ff:feb2:ee17"
              ],
              [
                "fe80::58dd:95ff:febc:bc43"
              ],
              [
                "fe80::801a:c3ff:feff:255"
              ],
              [
                "fe80::748f:f6ff:fe01:4d51"
              ],
              [
                "fe80::dcad:f7ff:fe1e:3310"
              ]
            ],
            "keyboard_layout": "en-us",
            "kvm_arguments": null,
            "mac_addresses": [
              "00:00:00:00:00:00",
              "BC:24:11:A4:AA:84",
              "CA:5D:FE:8E:58:08",
              "16:B5:89:2C:2E:D3",
              "26:8E:16:D3:40:5F",
              "22:40:F3:91:84:85",
              "72:5A:39:9A:25:A4",
              "CE:0A:C8:2C:F7:29",
              "EE:37:7A:72:F1:23",
              "0A:00:8C:91:68:6C",
              "EE:B5:21:1D:46:38",
              "4A:0C:FC:03:5C:72",
              "8E:FF:3D:D1:2B:05",
              "76:9C:B6:17:61:01",
              "3E:70:6B:F8:A6:C5",
              "7A:E6:88:F5:4A:8D",
              "46:24:D7:B2:52:DD",
              "EE:84:59:42:50:FE",
              "12:79:12:F0:75:17",
              "5A:4F:87:39:B6:01",
              "96:6C:6A:0E:28:BE",
              "66:C4:68:B2:EE:17",
              "5A:DD:95:BC:BC:43",
              "82:1A:C3:FF:02:55",
              "76:8F:F6:01:4D:51",
              "DE:AD:F7:1E:33:10"
            ],
            "machine": "q35",
            "memory": [
              {
                "dedicated": 12288,
                "floating": 0,
                "hugepages": "",
                "keep_hugepages": false,
                "shared": 0
              }
            ],
            "migrate": false,
            "name": "k3s-apps",
            "network_device": [
              {
                "bridge": "vmbr0",
                "disconnected": false,
                "enabled": true,
                "firewall": false,
                "mac_address": "BC:24:11:A4:AA:84",
                "model": "virtio",
                "mtu": 0,
                "queues": 0,
                "rate_limit": 0,
                "trunks": "",
                "vlan_id": 0
              }
            ],
            "network_interface_names": [
              "lo",
              "eth0",
              "flannel.1",
              "cni0",
              "vethecc432e3",
              "vethea2f11bc",
              "veth01f59774",
              "veth9ada66c7",
              "vethabbdb5dc",
              "veth4005f5bc",
              "vethb96c591f",
              "veth570748ed",
              "vethbc8c1b09",
              "vethf8b852a4",
              "veth125d91a7",
              "vetha30cc56a",
              "veth8fe38d2e",
              "vetha4afc941",
              "veth160859f8",
              "veth1f0783e6",
              "veth9043481d",
              "veth05f19f72",
              "vethd7266616",
              "vethdc04e92f",
              "vetha5ba81dd",
              "veth9dc62a49"
            ],
            "node_name": "server",
            "numa": [],
            "on_boot": true,
            "operating_system": [
              {
                "type": "l26"
              }
            ],
            "pool_id": "",
            "protection": false,
            "purge_on_destroy": true,
            "reboot": false,
            "reboot_after_update": true,
            "rng": [],
            "scsi_hardware": "virtio-scsi-single",
            "serial_device": [],
            "smbios": [],
            "started": true,
            "startup": [
              {
                "down_delay": 60,
                "order": 1,
                "up_delay": 60
              }
            ],
            "stop_on_destroy": false,
            "tablet_device": true,
            "tags": [
              "apps",
              "k3s"
            ],
            "template": false,
            "timeout_clone": 1800,
            "timeout_create": 1800,
            "timeout_migrate": 1800,
            "timeout_move_disk": 1800,
            "timeout_reboot": 1800,
            "timeout_shutdown_vm": 1800,
            "timeout_start_vm": 1800,
            "timeout_stop_vm": 300,
            "tpm_state": [],
            "usb": [],
            "vga": [],
            "virtiofs": [],
            "vm_id": 112,
            "watchdog": []
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "initialization"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "user_account"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "password"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "proxmox_virtual_environment_vm",
      "name": "whisper_gpu",
      "provider": "provider[\"registry.terraform.io/bpg/proxmox\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acpi": true,
            "agent": [],
            "amd_sev": [],
            "audio_device": [],
            "bios": "ovmf",
            "boot_order": [],
            "cdrom": [],
            "clone": [
              {
                "datastore_id": "",
                "full": true,
                "node_name": "server",
                "retries": 1,
                "vm_id": 9003
              }
            ],
            "cpu": [
              {
                "affinity": "",
                "architecture": "",
                "cores": 4,
                "flags": null,
                "hotplugged": 0,
                "limit": 0,
                "numa": false,
                "sockets": 1,
                "type": "host",
                "units": 0
              }
            ],
            "delete_unreferenced_disks_on_destroy": true,
            "description": "Whisper AI inference server with GPU passthrough",
            "disk": [
              {
                "aio": "io_uring",
                "backup": true,
                "cache": "none",
                "datastore_id": "local-lvm",
                "discard": "ignore",
                "file_format": "raw",
                "file_id": "",
                "import_from": "",
                "interface": "scsi0",
                "iothread": false,
                "path_in_datastore": "vm-115-disk-1",
                "replicate": true,
                "serial": "",
                "size": 50,
                "speed": [],
                "ssd": false
              }
            ],
            "efi_disk": [
              {
                "datastore_id": "local-lvm",
                "file_format": "raw",
                "pre_enrolled_keys": false,
                "type": "4m"
              }
            ],
            "hook_script_file_id": null,
            "hostpci": [
              {
                "device": "hostpci0",
                "id": "",
                "mapping": "gpu-quadro-m4000",
                "mdev": "",
                "pcie": true,
                "rom_file": "",
                "rombar": true,
                "xvga": false
              }
            ],
            "id": "115",
            "initialization": [
              {
                "datastore_id": "local-lvm",
                "dns": [
                  {
                    "domain": "",
                    "servers": [
                      "1.1.1.1"
                    ]
                  }
                ],
                "file_format": "",
                "interface": "ide2",
                "ip_config": [
                  {
                    "ipv4": [
                      {
                        "address": "192.168.20.30/24",
                        "gateway": "192.168.20.1"
                      }
                    ],
                    "ipv6": []
                  }
                ],
                "meta_data_file_id": "",
                "network_data_file_id": "",
                "type": "",
                "user_account": [
                  {
                    "keys": [
                      "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAhLzivPgJGOMkfj6Fg8WBbPvJIMLQHjpFTnXZVsncBg prakash2ji@gmail.com"
                    ],
                    "password": "**********",
                    "username": "deployer"
                  }
                ],
                "user_data_file_id": "local:snippets/whisper-cloud-init.yaml",
                "vendor_data_file_id": ""
              }
            ],
            "ipv4_addresses": [
              [
                "127.0.0.1"
              ],
              [
                "192.168.20.30"
              ]
            ],
            "ipv6_addresses": [
              [
                "::1"
              ],
              [
                "fdd5:945b:3322::43b",
                "fdd5:945b:3322:0:be24:11ff:feb8:d72a",
                "fe80::be24:11ff:feb8:d72a"
              ]
            ],
            "keyboard_layout": "en-us",
            "kvm_arguments": null,
            "mac_addresses": [
              "00:00:00:00:00:00",
              "BC:24:11:B8:D7:2A"
            ],
            "machine": "q35",
            "memory": [
              {
                "dedicated": 16384,
                "floating": 0,
                "hugepages": "",
                "keep_hugepages": false,
                "shared": 0
              }
            ],
            "migrate": false,
            "name": "whisper-gpu",
            "network_device": [
              {
                "bridge": "vmbr0",
                "disconnected": false,
                "enabled": true,
                "firewall": false,
                "mac_address": "BC:24:11:B8:D7:2A",
                "model": "virtio",
                "mtu": 0,
                "queues": 0,
                "rate_limit": 0,
                "trunks": "",
                "vlan_id": 0
              }
            ],
            "network_interface_names": [
              "lo",
              "eth0"
            ],
            "node_name": "server",
            "numa": [],
            "on_boot": true,
            "operating_system": [
              {
                "type": "l26"
              }
            ],
            "pool_id": "",
            "protection": false,
            "purge_on_destroy": true,
            "reboot": false,
            "reboot_after_update": true,
            "rng": [],
            "scsi_hardware": "virtio-scsi-single",
            "serial_device": [],
            "smbios": [],
            "started": true,
            "startup": [
              {
                "down_delay": 60,
                "order": 3,
                "up_delay": 120
              }
            ],
            "stop_on_destroy": false,
            "tablet_device": true,
            "tags": [
              "gpu",
              "ml",
              "whisper"
            ],
            "template": false,
            "timeout_clone": 1800,
            "timeout_create": 1800,
            "timeout_migrate": 1800,
            "timeout_move_disk": 1800,
            "timeout_reboot": 1800,
            "timeout_shutdown_vm": 1800,
            "timeout_start_vm": 1800,
            "timeout_stop_vm": 300,
            "tpm_state": [],
            "usb": [],
            "vga": [
              {
                "clipboard": "",
                "memory": 16,
                "type": "serial0"
              }
            ],
            "virtiofs": [],
            "vm_id": 115,
            "watchdog": []
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "initialization"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "user_account"
              },
              {
                "type": "index",
                "value": {
                  "value": 0,
                  "type": "number"
                }
              },
              {
                "type": "get_attr",
                "value": "password"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "bnVsbA==",
          "dependencies": [
            "proxmox_virtual_environment_file.whisper_cloud_init"
          ]
        }
      ]
    }
  ],
  "check_results": null
}
